<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="poems">
<title>Workflow example for the Tasmanian thylacine • poems</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Workflow example for the Tasmanian thylacine">
<meta property="og:description" content="poems">
<meta property="og:image" content="https://globalecologylab.github.io/poems/logo.svg">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">poems</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.1.1</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/simple_example.html">Simple workflow example for a population model</a>
    <a class="dropdown-item" href="../articles/thylacine_example.html">Workflow example for the Tasmanian thylacine</a>
    <a class="dropdown-item" href="../articles/translocation_example.html">Population introduction via translocation functions</a>
  </div>
</li>
<li class="nav-item">
  <a class="nav-link" href="../news/index.html">Changelog</a>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/GlobalEcologyLab/poems/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.svg" class="logo" alt=""><h1>Workflow example for the Tasmanian thylacine</h1>
                        <h4 data-toc-skip class="author">Global ChEC
Lab</h4>
            
            <h4 data-toc-skip class="date">2024-04-03</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/GlobalEcologyLab/poems/blob/HEAD/vignettes/thylacine_example.Rmd" class="external-link"><code>vignettes/thylacine_example.Rmd</code></a></small>
      <div class="d-none name"><code>thylacine_example.Rmd</code></div>
    </div>

    
    
<p>In this vignette we provide a more advanced example of the
<em>poems</em> workflow using a population model of the historic decline
of the <em>thylacine</em> in Tasmania, Australia. The <em>thylacine</em>
was a carnivorous marsupial that declined to extinction in response to
hunting and land-use change following European settlement of Australia.
As well as being hunted for the exotic fur and skin trade,
<em>thylacine</em> were also killed because they were considered a
threat to livestock. A government bounty was offered for eradicated
<em>thylacine</em> during the period 1888 until 1909 (Guiler 1985). We
model these hunting and bounty dynamics using a bio-economic approach
adapted from Bulte, Horan, and Shogren (2003). We build our model
ensemble by selecting the simulations most congruent to expected
extirpation/extinction dates and changes (regression slopes) in the
number of <em>thylacines</em> harvested during the bounty interval.
These targets are derived from historic bounty, capture and sighting
records.</p>
<div class="section level2">
<h2 id="setup">Setup<a class="anchor" aria-label="anchor" href="#setup"></a>
</h2>
<p>We begin by loading the <em>poems</em> package and setting our output
directory. We will set a flag for running the vignette in demonstration
mode (default). When set to <em>TRUE</em>, pre-run simulation results
are loaded rather than waiting (potentially hours) to run the full
sample model set. Feel free to set this flag to <em>FALSE</em> to run
your own simulations. You may also change the number of samples
generated, set the number of parallel cores available on your system,
and set the simulation output directory.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/GlobalEcologyLab/poems" class="external-link">poems</a></span><span class="op">)</span></span>
<span><span class="va">DEMONSTRATION</span> <span class="op">&lt;-</span> <span class="cn">TRUE</span> <span class="co"># load pre-run data rather than running simulations</span></span>
<span><span class="va">SAMPLES</span> <span class="op">&lt;-</span> <span class="fl">20000</span></span>
<span><span class="va">PARALLEL_CORES</span> <span class="op">&lt;-</span> <span class="fl">2</span></span>
<span><span class="va">OUTPUT_DIR</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/tempfile.html" class="external-link">tempdir</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="workflow">Workflow<a class="anchor" aria-label="anchor" href="#workflow"></a>
</h2>
<p>The <em>poems</em> workflow implements a pattern-oriented modeling
(POM) approach (Grimm et al., 2005), which can be broken into six
steps:</p>
<ol style="list-style-type: decimal">
<li>Build the population model for the study region.</li>
<li>Generate dynamic model parameters.</li>
<li>Sample model and generator parameters for each simulation.</li>
<li>Build a simulation manager to run each simulation.</li>
<li>Build a results manager to generate summary results (metrics).</li>
<li>Build a validator to select a model ensemble based on POM.</li>
</ol>
<div class="section level3">
<h3 id="step-1-build-the-population-model-for-the-study-region">Step 1: Build the population model for the study region<a class="anchor" aria-label="anchor" href="#step-1-build-the-population-model-for-the-study-region"></a>
</h3>
<p>We start by building a model template (using the
<em>PopulationModel</em> class) with fixed model parameters and
user-defined functions, including our bio-economic harvest function.
Since our model is spatially explicit, we also need to define our study
region (via the <em>Region</em> class).</p>
<div class="section level5">
<h5 id="tasmanian-study-region">Tasmanian study region<a class="anchor" aria-label="anchor" href="#tasmanian-study-region"></a>
</h5>
<p>First, we’ll define our study region via a <em>raster</em> of 0.1
degree grid-cells for the majority of Tasmania, once inhabited by the
<em>thylacine</em>. This <em>raster</em> of Tasmania accompanies the
<em>poems</em> package, and may be loaded via its variable name.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Raster of Tasmania (note: islands removed where there was no evidence of thylacine occupancy).</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">tasmania_raster</span><span class="op">)</span></span>
<span><span class="fu">raster</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/base/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">tasmania_raster</span>,</span>
<span>  main <span class="op">=</span> <span class="st">"Tasmania raster"</span>,</span>
<span>  xlab <span class="op">=</span> <span class="st">"Longitude (degrees)"</span>, ylab <span class="op">=</span> <span class="st">"Latitude (degrees)"</span>,</span>
<span>  colNA <span class="op">=</span> <span class="st">"blue"</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p><img src="thylacine_example_files/figure-html/unnamed-chunk-2-1.png" width="480" style="display: block; margin: auto;"></p>
<p>The grid-cell size was selected as a reasonable approximation for
<em>thylacine</em> territorial range (Guiler &amp; Godard, 1998).</p>
<p>To define our region, we will use this <em>raster</em> of Tasmania as
a template for the <em>Region</em> object, which will set the occupiable
cell indices in the order in which they are stored in the
<em>raster</em>.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Tasmania study region (795 cells stored in the order shown)</span></span>
<span><span class="va">region</span> <span class="op">&lt;-</span> <span class="va"><a href="../reference/Region.html">Region</a></span><span class="op">$</span><span class="fu">new</span><span class="op">(</span>template_raster <span class="op">=</span> <span class="va">tasmania_raster</span><span class="op">)</span></span>
<span><span class="fu">raster</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/base/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">region</span><span class="op">$</span><span class="va">region_raster</span>,</span>
<span>  main <span class="op">=</span> <span class="st">"Tasmanian study region (cell indices)"</span>,</span>
<span>  xlab <span class="op">=</span> <span class="st">"Longitude (degrees)"</span>, ylab <span class="op">=</span> <span class="st">"Latitude (degrees)"</span>,</span>
<span>  colNA <span class="op">=</span> <span class="st">"blue"</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p><img src="thylacine_example_files/figure-html/unnamed-chunk-3-1.png" width="480" style="display: block; margin: auto;"></p>
</div>
<div class="section level5">
<h5 id="ibra-bioregions">IBRA bioregions<a class="anchor" aria-label="anchor" href="#ibra-bioregions"></a>
</h5>
<p>We partition our study region into Interim Bioregionalisation of
Australia (IBRA) bioregions for several purposes. Our harvest function
will distribute our simulated harvest across these IBRA bioregions. We
will also use these IBRA bioregions to approximate spatial differences
in habitat suitability decline. In step 6, we will use estimated
extirpation dates for each IBRA bioregion when selecting our model
ensemble. A <em>raster</em> of the approximate distribution of our study
region cells across IBRA bioregions, as well as a <em>data frame</em>
containing information about each IBRA bioregion, are included with the
<em>poems</em> package. Here we also collate lists of indices and the
number of cells for each bioregion.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Tasmania study Interim Bioregionalisation of Australia (IBRA) bioregion cell distribution</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">tasmania_ibra_raster</span><span class="op">)</span></span>
<span><span class="fu">raster</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/base/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">tasmania_ibra_raster</span>,</span>
<span>  main <span class="op">=</span> <span class="st">"Tasmania study IBRA bioregions"</span>, colNA <span class="op">=</span> <span class="st">"blue"</span>,</span>
<span>  xlab <span class="op">=</span> <span class="st">"Longitude (degrees)"</span>, ylab <span class="op">=</span> <span class="st">"Latitude (degrees)"</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p><img src="thylacine_example_files/figure-html/unnamed-chunk-4-1.png" width="480" style="display: block; margin: auto;"></p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">tasmania_ibra_data</span><span class="op">)</span></span>
<span><span class="va">tasmania_ibra_data</span> <span class="co"># examine</span></span>
<span><span class="co">#&gt;   index key abbr                        name</span></span>
<span><span class="co">#&gt; 1     1   A  FUR                    Furneaux</span></span>
<span><span class="co">#&gt; 2     2   B  BEN                  Ben Lomond</span></span>
<span><span class="co">#&gt; 3     3   C  TNM Tasmanian Northern Midlands</span></span>
<span><span class="co">#&gt; 4     4   D  TSE        Tasmanian South East</span></span>
<span><span class="co">#&gt; 5     5   E   TW              Tasmanian West</span></span>
<span><span class="co">#&gt; 6     6   F  TNS   Tasmanian Northern Slopes</span></span>
<span><span class="co">#&gt; 7     7   G  TSR   Tasmanian Southern Ranges</span></span>
<span><span class="co">#&gt; 8     8   H  TCH Tasmanian Central Highlands</span></span>
<span><span class="co">#&gt; 9     9   I  KIN                        King</span></span>
<span></span>
<span><span class="co"># Calculate cell indices and counts for IBRA bioregions</span></span>
<span><span class="va">ibra_indices</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">as.list</a></span><span class="op">(</span><span class="va">tasmania_ibra_data</span><span class="op">$</span><span class="va">index</span><span class="op">)</span>,</span>
<span>  <span class="kw">function</span><span class="op">(</span><span class="va">i</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/which.html" class="external-link">which</a></span><span class="op">(</span><span class="va">tasmania_ibra_raster</span><span class="op">[</span><span class="va">region</span><span class="op">$</span><span class="va">region_indices</span><span class="op">]</span> <span class="op">==</span> <span class="va">i</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span><span class="op">)</span></span>
<span><span class="va">ibra_indices</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">2</span><span class="op">]</span> <span class="co"># examine</span></span>
<span><span class="co">#&gt; [[1]]</span></span>
<span><span class="co">#&gt;  [1]  13  14  15  25  26  27  28  29  30  31  44  45  46  47  48  50  52  53  54</span></span>
<span><span class="co">#&gt; [20]  55  71  72  73  74  75  76  77  78  79  85  86  87 105 106 107 108 109 110</span></span>
<span><span class="co">#&gt; [39] 124 143 161 197 198 233 234 270</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; [[2]]</span></span>
<span><span class="co">#&gt;  [1]  49  51  80  81  82  83  84 111 112 113 114 115 116 117 118 119 120 121 122</span></span>
<span><span class="co">#&gt; [20] 123 148 149 150 151 152 153 154 155 156 157 158 159 160 187 188 189 190 191</span></span>
<span><span class="co">#&gt; [39] 192 193 194 195 196 225 226 227 228 229 230 231 232 261 262 263 264 265 266</span></span>
<span><span class="co">#&gt; [58] 267 268 269 296 297 298 299 300 301 302 303 304 305 332 333 334 335 336 337</span></span>
<span><span class="va">ibra_cells</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/unlist.html" class="external-link">unlist</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="va">ibra_indices</span>, <span class="va">length</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">ibra_cells</span> <span class="co"># examine</span></span>
<span><span class="co">#&gt; [1]  46  76  40 147 188  72  93  86  47</span></span></code></pre></div>
</div>
<div class="section level5">
<h5 id="density-dependence-function">Density dependence function<a class="anchor" aria-label="anchor" href="#density-dependence-function"></a>
</h5>
<p>Here we create a user-defined function for density dependence
utilizing the logistic approach (Ricker, 1954). Although the
<em>poems</em> package has the Ricker logistic function as a predefined
function operating at the population grid-cell level (via
<em>density_dependence = “logistic”</em>), this was found to be
inadequate for our <em>thylacine</em> model due to low densities of
<em>thylacine</em> at the grid-cell level. To overcome this our density
dependence function operates at a neighborhood level, where each cell’s
neighborhood include its adjacent cells (thus up to 9 cells in total).
This approach considers the mobility of the <em>thylacine</em> when
calculating annual reproduction and survival rates, whereby individuals
have the ability to search for mates or more suitable habitat in
neighboring cells.</p>
<p>In order to first define our neighborhoods for our density dependence
function, it is convenient to partially skip ahead to step 2 (building
generators) and build our dispersal generator.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Build the dispersal generator and calculate distance data</span></span>
<span><span class="va">dispersal_gen</span> <span class="op">&lt;-</span> <span class="va"><a href="../reference/DispersalGenerator.html">DispersalGenerator</a></span><span class="op">$</span><span class="fu">new</span><span class="op">(</span></span>
<span>  region <span class="op">=</span> <span class="va">region</span>,</span>
<span>  dispersal_max_distance <span class="op">=</span> <span class="fl">50</span>,</span>
<span>  distance_scale <span class="op">=</span> <span class="fl">1000</span>, <span class="co"># in km</span></span>
<span>  dispersal_friction <span class="op">=</span> <span class="va"><a href="../reference/DispersalFriction.html">DispersalFriction</a></span><span class="op">$</span><span class="fu">new</span><span class="op">(</span><span class="op">)</span>, <span class="co"># modify coastline distances</span></span>
<span>  inputs <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"dispersal_p"</span>, <span class="st">"dispersal_b"</span><span class="op">)</span>,</span>
<span>  decimals <span class="op">=</span> <span class="fl">5</span></span>
<span><span class="op">)</span></span>
<span><span class="va">dispersal_gen</span><span class="op">$</span><span class="fu">calculate_distance_data</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">dispersal_gen</span><span class="op">$</span><span class="va">distance_data</span><span class="op">$</span><span class="va">base</span><span class="op">)</span> <span class="co"># examine</span></span>
<span><span class="co">#&gt;   target_pop source_pop compact_row distance_class</span></span>
<span><span class="co">#&gt; 1          2          1           1              9</span></span>
<span><span class="co">#&gt; 2          3          1           2             17</span></span>
<span><span class="co">#&gt; 3          4          1           3             26</span></span>
<span><span class="co">#&gt; 4          5          1           4             14</span></span>
<span><span class="co">#&gt; 5          6          1           5             12</span></span>
<span><span class="co">#&gt; 6          7          1           6             14</span></span></code></pre></div>
<p>We will use the generator for its dispersal functionality later, but
for now we will use it to calculate distance data in order to define our
neighborhoods of adjacent cells for each grid-cell. At our defined
spatial resolution, adjacent cells are within 14 km from each cell.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Define neighborhoods (of up to 9 adjacent cells) based on a 14 km range from each</span></span>
<span><span class="co"># grid cell for density dependence calculations (using a dispersal generator)</span></span>
<span><span class="va">distance_data</span> <span class="op">&lt;-</span> <span class="va">dispersal_gen</span><span class="op">$</span><span class="va">distance_data</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span></span>
<span><span class="va">nh_data</span> <span class="op">&lt;-</span> <span class="va">distance_data</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/which.html" class="external-link">which</a></span><span class="op">(</span><span class="va">distance_data</span><span class="op">$</span><span class="va">distance_class</span> <span class="op">&lt;=</span> <span class="fl">14</span><span class="op">)</span>, <span class="fl">2</span><span class="op">:</span><span class="fl">1</span><span class="op">]</span></span>
<span><span class="va">neighborhoods</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">as.list</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">795</span><span class="op">)</span></span>
<span><span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">nh_data</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">neighborhoods</span><span class="op">[[</span><span class="va">nh_data</span><span class="op">$</span><span class="va">source_pop</span><span class="op">[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span></span>
<span>    <span class="va">neighborhoods</span><span class="op">[[</span><span class="va">nh_data</span><span class="op">$</span><span class="va">source_pop</span><span class="op">[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span><span class="op">]</span>,</span>
<span>    <span class="va">nh_data</span><span class="op">$</span><span class="va">target_pop</span><span class="op">[</span><span class="va">i</span><span class="op">]</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">}</span></span>
<span><span class="va">neighborhoods</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">3</span><span class="op">]</span> <span class="co"># examine</span></span>
<span><span class="co">#&gt; [[1]]</span></span>
<span><span class="co">#&gt; [1] 1 2 5 6 7</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; [[2]]</span></span>
<span><span class="co">#&gt; [1] 2 1 3 6 7 8</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; [[3]]</span></span>
<span><span class="co">#&gt; [1] 3 2 4 7 8 9</span></span></code></pre></div>
<p>We can now define our density dependence function, which is
list-nested with our neighborhoods and an Allee effect (Allee, 1931)
parameter. We apply a Tasmania-wide Allee effect to suppress a sustained
low, non-viable population. Additional functionality is also included to
prevent reproduction when a neighborhood has a single
<em>thylacine</em>. We also define an alias to the Allee parameter so we
can sample it later.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># User-defined function for Ricker logistic density dependence via neighborhoods, with</span></span>
<span><span class="co"># Allee effects; also remove fecundities if single thylacine in a neighborhood</span></span>
<span><span class="va">density_dependence</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>  neighborhoods <span class="op">=</span> <span class="va">neighborhoods</span>,</span>
<span>  allee <span class="op">=</span> <span class="fl">25</span>, <span class="co"># Tasmania-wide Allee effect parameter</span></span>
<span>  <span class="kw">function</span><span class="op">(</span><span class="va">params</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="co"># Apply logistic density dependence using neighborhoods</span></span>
<span>    <span class="va">growth_rate_max</span> <span class="op">&lt;-</span> <span class="va">params</span><span class="op">$</span><span class="va">growth_rate_max</span></span>
<span>    <span class="va">nh_density_abundance</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/unlist.html" class="external-link">unlist</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span></span>
<span>      <span class="va">params</span><span class="op">$</span><span class="va">neighborhoods</span>,</span>
<span>      <span class="kw">function</span><span class="op">(</span><span class="va">nh_indices</span><span class="op">)</span> <span class="op">{</span></span>
<span>        <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">params</span><span class="op">$</span><span class="va">density_abundance</span><span class="op">[</span><span class="va">nh_indices</span><span class="op">]</span><span class="op">)</span></span>
<span>      <span class="op">}</span></span>
<span>    <span class="op">)</span><span class="op">)</span></span>
<span>    <span class="va">nh_carrying_capacity</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/unlist.html" class="external-link">unlist</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span></span>
<span>      <span class="va">params</span><span class="op">$</span><span class="va">neighborhoods</span>,</span>
<span>      <span class="kw">function</span><span class="op">(</span><span class="va">nh_indices</span><span class="op">)</span> <span class="op">{</span></span>
<span>        <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">params</span><span class="op">$</span><span class="va">carrying_capacity</span><span class="op">[</span><span class="va">nh_indices</span><span class="op">]</span><span class="op">)</span></span>
<span>      <span class="op">}</span></span>
<span>    <span class="op">)</span><span class="op">)</span></span>
<span>    <span class="va">occupied_indices</span> <span class="op">&lt;-</span> <span class="va">params</span><span class="op">$</span><span class="va">occupied_indices</span></span>
<span>    <span class="va">growth_rate</span> <span class="op">&lt;-</span> <span class="va">growth_rate_max</span> <span class="op">*</span> <span class="op">(</span><span class="fl">1</span> <span class="op">-</span> <span class="op">(</span><span class="va">nh_density_abundance</span><span class="op">[</span><span class="va">occupied_indices</span><span class="op">]</span> <span class="op">/</span></span>
<span>      <span class="va">nh_carrying_capacity</span><span class="op">[</span><span class="va">occupied_indices</span><span class="op">]</span><span class="op">)</span><span class="op">)</span></span>
<span>    <span class="va">params</span><span class="op">$</span><span class="va">transition_array</span><span class="op">[</span>, , <span class="va">occupied_indices</span><span class="op">]</span> <span class="op">&lt;-</span></span>
<span>      <span class="va">params</span><span class="op">$</span><span class="fu">apply_multipliers</span><span class="op">(</span></span>
<span>        <span class="va">params</span><span class="op">$</span><span class="va">transition_array</span><span class="op">[</span>, , <span class="va">occupied_indices</span><span class="op">]</span>,</span>
<span>        <span class="va">params</span><span class="op">$</span><span class="fu">calculate_multipliers</span><span class="op">(</span><span class="va">growth_rate</span><span class="op">)</span></span>
<span>      <span class="op">)</span></span>
<span></span>
<span>    <span class="co"># Apply Tasmania-wide allee effect</span></span>
<span>    <span class="va">total_abundance</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">params</span><span class="op">$</span><span class="va">density_abundance</span><span class="op">)</span></span>
<span>    <span class="va">params</span><span class="op">$</span><span class="va">transition_array</span> <span class="op">&lt;-</span></span>
<span>      <span class="va">params</span><span class="op">$</span><span class="va">transition_array</span> <span class="op">*</span> <span class="va">total_abundance</span> <span class="op">/</span> <span class="op">(</span><span class="va">params</span><span class="op">$</span><span class="va">allee</span> <span class="op">+</span> <span class="va">total_abundance</span><span class="op">)</span></span>
<span></span>
<span>    <span class="co"># Remove fecundities for single thylacines</span></span>
<span>    <span class="va">single_indices</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/which.html" class="external-link">which</a></span><span class="op">(</span><span class="va">nh_density_abundance</span> <span class="op">==</span> <span class="fl">1</span><span class="op">)</span></span>
<span>    <span class="va">params</span><span class="op">$</span><span class="va">transition_array</span><span class="op">[</span>, , <span class="va">single_indices</span><span class="op">]</span> <span class="op">&lt;-</span></span>
<span>      <span class="op">(</span><span class="va">params</span><span class="op">$</span><span class="va">transition_array</span><span class="op">[</span>, , <span class="va">single_indices</span><span class="op">]</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/base/vector.html" class="external-link">as.vector</a></span><span class="op">(</span><span class="op">+</span><span class="op">(</span><span class="op">!</span><span class="va">params</span><span class="op">$</span><span class="va">fecundity_mask</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span>    <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="va">params</span><span class="op">$</span><span class="va">transition_array</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span><span class="op">)</span></span>
<span><span class="va">density_aliases</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>density_allee <span class="op">=</span> <span class="st">"density_dependence$allee"</span><span class="op">)</span></span></code></pre></div>
<p>Note that after calculating a modified growth rate via neighborhood
abundance and carrying capacity for each cell, we utilize a lookup table
(calculated at the time of simulation) so as to apply a multiplier to
the stage matrix corresponding to each cell, thus modifying its
equivalent growth rate appropriately.</p>
</div>
<div class="section level5">
<h5 id="harvest-function">Harvest function<a class="anchor" aria-label="anchor" href="#harvest-function"></a>
</h5>
<p>Let’s now define our bio-economic harvest function, which is
optionally list-nested with harvest parameters. The total
(Tasmania-wide) number of <em>thylacines</em> harvested at each model
simulation time step is calculated via the combination of a constant
opportunistic harvest rate plus a bio-economic component adapted from
Bulte et al.  (2003). The bio-economic component simulates hunting
effort based on economic return (or profit), relative to other economic
alternatives. Economic hunting rewards include a bounty applied during
the bounty period (1888-1909), plus an ongoing reward for pelts. It has
been estimated that up to half of <em>thylacines</em> killed were not
submitted for bounty (Guiler &amp; Godard, 1998). We therefore include
an additional parameter in our harvest model to calculate the fraction
of each harvest that is submitted for bounty. Once we calculate our
simulated yearly total harvest and bounty, we then distribute them
across IBRA bioregions based on <em>thylacine</em> bioregion densities.
We define aliases for the harvest/bounty parameters so we can sample
them later.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Harvest bounty (economic) model user-defined function adapted from Bulte et al. (2003).</span></span>
<span><span class="va">harvest</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span></span>
<span>  <span class="co"># Function parameters (passed to function in params list)</span></span>
<span>  ohr <span class="op">=</span> <span class="fl">0.05</span>, <span class="co"># opportunistic harvest rate</span></span>
<span>  t1 <span class="op">=</span> <span class="fl">1888</span>, <span class="co"># first year of bounty</span></span>
<span>  tb <span class="op">=</span> <span class="fl">1909</span>, <span class="co"># last year of bounty</span></span>
<span>  fb <span class="op">=</span> <span class="fl">0.75</span>, <span class="co"># harvest fraction submitted for bounty</span></span>
<span>  B <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1.6</span>, <span class="fl">0.6</span><span class="op">)</span>, <span class="co"># bounty/skin price in pounds, pre/post bounty</span></span>
<span>  w <span class="op">=</span> <span class="fl">3.5</span>, <span class="co"># opportunity cost in pounds per year</span></span>
<span>  E0 <span class="op">=</span> <span class="fl">25</span>, <span class="co"># effort in 1888 (no. hunters)</span></span>
<span>  q <span class="op">=</span> <span class="fl">0.0025</span>, <span class="co"># catchability coefficient</span></span>
<span>  v1 <span class="op">=</span> <span class="fl">0.02</span>, <span class="co"># entry rate</span></span>
<span>  v2 <span class="op">=</span> <span class="fl">0.5</span>, <span class="co"># exit rate</span></span>
<span>  ibra_indices <span class="op">=</span> <span class="va">ibra_indices</span>, <span class="co"># bioregion cell (row) indices</span></span>
<span>  ibra_cells <span class="op">=</span> <span class="va">ibra_cells</span>, <span class="co"># number of cells in bioregions</span></span>
<span></span>
<span>  <span class="co"># Function definition</span></span>
<span>  bounty_function <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">params</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="co"># Unpack parameters (used at every time step)</span></span>
<span>    <span class="va">ohr</span> <span class="op">&lt;-</span> <span class="va">params</span><span class="op">$</span><span class="va">ohr</span></span>
<span>    <span class="va">t1</span> <span class="op">&lt;-</span> <span class="va">params</span><span class="op">$</span><span class="va">t1</span></span>
<span>    <span class="va">tb</span> <span class="op">&lt;-</span> <span class="va">params</span><span class="op">$</span><span class="va">tb</span></span>
<span>    <span class="va">fb</span> <span class="op">&lt;-</span> <span class="va">params</span><span class="op">$</span><span class="va">fb</span></span>
<span>    <span class="va">B</span> <span class="op">&lt;-</span> <span class="va">params</span><span class="op">$</span><span class="va">B</span></span>
<span>    <span class="va">w</span> <span class="op">&lt;-</span> <span class="va">params</span><span class="op">$</span><span class="va">w</span></span>
<span>    <span class="va">q</span> <span class="op">&lt;-</span> <span class="va">params</span><span class="op">$</span><span class="va">q</span></span>
<span>    <span class="va">v1</span> <span class="op">&lt;-</span> <span class="va">params</span><span class="op">$</span><span class="va">v1</span></span>
<span>    <span class="va">v2</span> <span class="op">&lt;-</span> <span class="va">params</span><span class="op">$</span><span class="va">v2</span></span>
<span>    <span class="va">ibra_indices</span> <span class="op">&lt;-</span> <span class="va">params</span><span class="op">$</span><span class="va">ibra_indices</span></span>
<span>    <span class="va">ibra_cells</span> <span class="op">&lt;-</span> <span class="va">params</span><span class="op">$</span><span class="va">ibra_cells</span></span>
<span>    <span class="va">ibra_number</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">ibra_cells</span><span class="op">)</span></span>
<span>    <span class="va">stages</span> <span class="op">&lt;-</span> <span class="va">params</span><span class="op">$</span><span class="va">stages</span></span>
<span>    <span class="va">populations</span> <span class="op">&lt;-</span> <span class="va">params</span><span class="op">$</span><span class="va">populations</span></span>
<span>    <span class="va">simulator</span> <span class="op">&lt;-</span> <span class="va">params</span><span class="op">$</span><span class="va">simulator</span></span>
<span>    <span class="va">tm</span> <span class="op">&lt;-</span> <span class="va">params</span><span class="op">$</span><span class="va">tm</span></span>
<span>    <span class="va">x</span> <span class="op">&lt;-</span> <span class="va">params</span><span class="op">$</span><span class="va">stage_abundance</span></span>
<span></span>
<span>    <span class="co"># Initialise (first time step only)</span></span>
<span>    <span class="kw">if</span> <span class="op">(</span><span class="va">tm</span> <span class="op">==</span> <span class="fl">1</span><span class="op">)</span> <span class="op">{</span> <span class="co"># attach variables and access results via simulator reference object</span></span>
<span>      <span class="va">simulator</span><span class="op">$</span><span class="va">attached</span><span class="op">$</span><span class="va">E</span> <span class="op">&lt;-</span> <span class="va">params</span><span class="op">$</span><span class="va">E0</span> <span class="co"># current bounty effort</span></span>
<span>      <span class="va">simulator</span><span class="op">$</span><span class="va">attached</span><span class="op">$</span><span class="va">vi</span> <span class="op">&lt;-</span> <span class="va">v1</span> <span class="co"># current bounty rate</span></span>
<span>      <span class="va">simulator</span><span class="op">$</span><span class="va">results</span><span class="op">$</span><span class="va">bounty</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/array.html" class="external-link">array</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">ibra_number</span>, <span class="va">params</span><span class="op">$</span><span class="va">time_steps</span><span class="op">)</span><span class="op">)</span></span>
<span>    <span class="op">}</span></span>
<span></span>
<span>    <span class="co"># Access persistent parameters via simulator reference object</span></span>
<span>    <span class="va">E</span> <span class="op">&lt;-</span> <span class="va">simulator</span><span class="op">$</span><span class="va">attached</span><span class="op">$</span><span class="va">E</span></span>
<span>    <span class="va">vi</span> <span class="op">&lt;-</span> <span class="va">simulator</span><span class="op">$</span><span class="va">attached</span><span class="op">$</span><span class="va">vi</span></span>
<span></span>
<span>    <span class="co"># Next year's hunting effort and entry/exit rates based on this year's profit</span></span>
<span>    <span class="va">h</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="op">(</span><span class="va">ohr</span> <span class="op">+</span> <span class="va">q</span> <span class="op">*</span> <span class="va">E</span><span class="op">)</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="co"># harvest</span></span>
<span>    <span class="va">b</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="va">h</span> <span class="op">*</span> <span class="va">fb</span> <span class="op">*</span> <span class="op">(</span><span class="op">(</span><span class="va">tm</span> <span class="op">+</span> <span class="va">t1</span> <span class="op">-</span> <span class="fl">1</span><span class="op">)</span> <span class="op">&lt;=</span> <span class="va">tb</span><span class="op">)</span><span class="op">)</span> <span class="co"># bounty submitted</span></span>
<span>    <span class="va">profit</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="va">B</span><span class="op">[</span><span class="op">(</span><span class="op">(</span><span class="va">tm</span> <span class="op">+</span> <span class="va">t1</span> <span class="op">-</span> <span class="fl">1</span><span class="op">)</span> <span class="op">&gt;</span> <span class="va">tb</span><span class="op">)</span> <span class="op">+</span> <span class="fl">1</span><span class="op">]</span> <span class="op">*</span> <span class="va">b</span> <span class="op">+</span> <span class="va">B</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span> <span class="op">*</span> <span class="op">(</span><span class="va">h</span> <span class="op">-</span> <span class="va">b</span><span class="op">)</span> <span class="op">-</span> <span class="va">w</span> <span class="op">*</span> <span class="va">E</span>, <span class="fl">1</span><span class="op">)</span></span>
<span>    <span class="va">simulator</span><span class="op">$</span><span class="va">attached</span><span class="op">$</span><span class="va">E</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="va">E</span> <span class="op">+</span> <span class="va">vi</span> <span class="op">*</span> <span class="va">profit</span><span class="op">)</span><span class="op">)</span></span>
<span>    <span class="va">simulator</span><span class="op">$</span><span class="va">attached</span><span class="op">$</span><span class="va">vi</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">v1</span>, <span class="va">v2</span><span class="op">)</span><span class="op">[</span><span class="op">(</span><span class="va">profit</span> <span class="op">&lt;</span> <span class="fl">0</span><span class="op">)</span> <span class="op">+</span> <span class="fl">1</span><span class="op">]</span></span>
<span></span>
<span>    <span class="co"># Distribute harvest and bounty across bioregions based on each IBRA density</span></span>
<span>    <span class="va">staged_indices</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/array.html" class="external-link">array</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="op">(</span><span class="va">stages</span> <span class="op">*</span> <span class="va">populations</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">stages</span>, <span class="va">populations</span><span class="op">)</span><span class="op">)</span></span>
<span>    <span class="va">rep_indices</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/unlist.html" class="external-link">unlist</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/apply.html" class="external-link">apply</a></span><span class="op">(</span></span>
<span>      <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="va">staged_indices</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/unlist.html" class="external-link">unlist</a></span><span class="op">(</span><span class="va">ibra_indices</span><span class="op">)</span><span class="op">]</span><span class="op">)</span>, <span class="fl">1</span>,</span>
<span>      <span class="kw">function</span><span class="op">(</span><span class="va">i</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="va">i</span>, <span class="va">x</span><span class="op">[</span><span class="va">i</span><span class="op">]</span><span class="op">)</span></span>
<span>    <span class="op">)</span><span class="op">)</span></span>
<span>    <span class="va">distributed_h</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/array.html" class="external-link">array</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">stages</span>, <span class="va">populations</span><span class="op">)</span><span class="op">)</span></span>
<span>    <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">rep_indices</span><span class="op">)</span> <span class="op">&amp;&amp;</span> <span class="va">h</span> <span class="op">&gt;</span> <span class="fl">0</span><span class="op">)</span> <span class="op">{</span></span>
<span>      <span class="va">ibra_x</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/unlist.html" class="external-link">unlist</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="va">ibra_indices</span>, <span class="kw">function</span><span class="op">(</span><span class="va">indices</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">x</span><span class="op">[</span>, <span class="va">indices</span><span class="op">]</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span>      <span class="va">rep_ibra</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/unlist.html" class="external-link">unlist</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/apply.html" class="external-link">apply</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="va">ibra_number</span><span class="op">)</span>, <span class="fl">1</span>, <span class="kw">function</span><span class="op">(</span><span class="va">i</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="va">i</span>, <span class="va">ibra_x</span><span class="op">[</span><span class="va">i</span><span class="op">]</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span>      <span class="va">rep_prob</span> <span class="op">&lt;-</span> <span class="fl">1</span> <span class="op">/</span> <span class="va">ibra_cells</span><span class="op">[</span><span class="va">rep_ibra</span><span class="op">]</span></span>
<span>      <span class="va">h_indices</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">rep_indices</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">min</a></span><span class="op">(</span><span class="va">h</span>, <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">)</span>, prob <span class="op">=</span> <span class="va">rep_prob</span><span class="op">)</span></span>
<span>      <span class="kw">if</span> <span class="op">(</span><span class="va">b</span> <span class="op">&gt;</span> <span class="fl">0</span><span class="op">)</span> <span class="op">{</span></span>
<span>        <span class="va">b_indices</span> <span class="op">&lt;-</span> <span class="va">h_indices</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">h_indices</span><span class="op">)</span>, <span class="va">b</span><span class="op">)</span><span class="op">]</span></span>
<span>        <span class="va">simulator</span><span class="op">$</span><span class="va">results</span><span class="op">$</span><span class="va">bounty</span><span class="op">[</span>, <span class="va">tm</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/tabulate.html" class="external-link">tabulate</a></span><span class="op">(</span><span class="va">rep_ibra</span><span class="op">[</span><span class="va">b_indices</span><span class="op">]</span>,</span>
<span>          nbins <span class="op">=</span> <span class="va">ibra_number</span></span>
<span>        <span class="op">)</span></span>
<span>      <span class="op">}</span></span>
<span>      <span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="va">rep_indices</span><span class="op">[</span><span class="va">h_indices</span><span class="op">]</span><span class="op">)</span> <span class="va">distributed_h</span><span class="op">[</span><span class="va">i</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">distributed_h</span><span class="op">[</span><span class="va">i</span><span class="op">]</span> <span class="op">+</span> <span class="fl">1</span></span>
<span>    <span class="op">}</span></span>
<span></span>
<span>    <span class="co"># Return abundance</span></span>
<span>    <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="va">x</span> <span class="op">-</span> <span class="va">distributed_h</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span><span class="op">)</span></span>
<span><span class="va">harvest_aliases</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>  harvest_ohr <span class="op">=</span> <span class="st">"harvest$ohr"</span>, harvest_fb <span class="op">=</span> <span class="st">"harvest$fb"</span>,</span>
<span>  harvest_w <span class="op">=</span> <span class="st">"harvest$w"</span>, harvest_E0 <span class="op">=</span> <span class="st">"harvest$E0"</span>,</span>
<span>  harvest_q <span class="op">=</span> <span class="st">"harvest$q"</span>, harvest_v1 <span class="op">=</span> <span class="st">"harvest$v1"</span>,</span>
<span>  harvest_v2 <span class="op">=</span> <span class="st">"harvest$v2"</span></span>
<span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level5">
<h5 id="template-model">Template model<a class="anchor" aria-label="anchor" href="#template-model"></a>
</h5>
<p>Finally, we can build our template model with these user-defined
functions and their associated parameters, as well as other fixed model
parameters.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Population (simulation) model template for fixed parameters</span></span>
<span><span class="va">model_template</span> <span class="op">&lt;-</span> <span class="va"><a href="../reference/PopulationModel.html">PopulationModel</a></span><span class="op">$</span><span class="fu">new</span><span class="op">(</span></span>
<span>  region <span class="op">=</span> <span class="va">region</span>,</span>
<span>  time_steps <span class="op">=</span> <span class="fl">80</span>, <span class="co"># years (1888-1967)</span></span>
<span>  populations <span class="op">=</span> <span class="va">region</span><span class="op">$</span><span class="va">region_cells</span>, <span class="co"># 795</span></span>
<span>  <span class="co"># initial_abundance : generated</span></span>
<span>  <span class="co"># stage_matrix: generated</span></span>
<span>  fecundity_max <span class="op">=</span> <span class="fl">2</span>,</span>
<span>  demographic_stochasticity <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  <span class="co"># carrying_capacity : generated</span></span>
<span>  density_dependence <span class="op">=</span> <span class="va">density_dependence</span>, <span class="co"># user-defined</span></span>
<span>  harvest <span class="op">=</span> <span class="va">harvest</span>, <span class="co"># user-defined</span></span>
<span>  <span class="co"># dispersal : generated</span></span>
<span>  dispersal_target_k <span class="op">=</span> <span class="fl">0.5</span>,</span>
<span>  dispersal_target_n <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>threshold <span class="op">=</span> <span class="fl">4</span>, cutoff <span class="op">=</span> <span class="fl">8</span><span class="op">)</span>,</span>
<span>  simulation_order <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"results"</span>, <span class="st">"harvest"</span>, <span class="st">"transition"</span>, <span class="st">"dispersal"</span><span class="op">)</span>,</span>
<span>  results_selection <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"abundance"</span>, <span class="st">"harvested"</span><span class="op">)</span>,</span>
<span>  attribute_aliases <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">density_aliases</span>, <span class="va">harvest_aliases</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>Note the use of thresholds/cutoffs for dispersal target carrying
capacities and abundances. The former suppress dispersal to cells with
near-zero suitability, whereas the latter prevent model
<em>thylacines</em> from overcrowding cells. When overridden, the
simulation order may allow the initial abundance to be included in the
results. Also note the commented placeholders for model parameters that
will be sampled or generated.</p>
</div>
</div>
<div class="section level3">
<h3 id="step-2-build-generators-for-dynamically-generating-model-parameters">Step 2: Build generators for dynamically generating model
parameters<a class="anchor" aria-label="anchor" href="#step-2-build-generators-for-dynamically-generating-model-parameters"></a>
</h3>
<p>Here we build a generator for combined model initial abundance and
carrying capacity, as well as a generator for generating a stage matrix
for each sampled model based on sampled growth rate. We will test our
generators, including our pre-built dispersal generator (from part 1),
by generating some example outputs.</p>
<div class="section level5">
<h5 id="initial-habitat-suitability">Initial habitat suitability<a class="anchor" aria-label="anchor" href="#initial-habitat-suitability"></a>
</h5>
<p>Firstly, our initial abundance and carrying capacity generator
utilizes the habitat suitability for our study region. The initial
habitat suitability was derived from a species distribution model (SDM)
for the <em>thylacine</em>. The initial habitat suitability
<em>raster</em> has also been included with the <em>poems</em>
package.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Initial thylacine habitat suitability</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">thylacine_hs_raster</span><span class="op">)</span></span>
<span><span class="fu">raster</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/base/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">thylacine_hs_raster</span>,</span>
<span>  main <span class="op">=</span> <span class="st">"Initial thylacine habitat suitability"</span>, colNA <span class="op">=</span> <span class="st">"blue"</span>,</span>
<span>  xlab <span class="op">=</span> <span class="st">"Longitude (degrees)"</span>, ylab <span class="op">=</span> <span class="st">"Latitude (degrees)"</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p><img src="thylacine_example_files/figure-html/unnamed-chunk-10-1.png" width="480" style="display: block; margin: auto;"></p>
</div>
<div class="section level5">
<h5 id="habitat-decline">Habitat decline<a class="anchor" aria-label="anchor" href="#habitat-decline"></a>
</h5>
<p>Bulte et al. (2003) estimated a 3% per annum Tasmania-wide decline in
<em>thylacine</em> habitat suitability due to human land use. To
approximate spatial differences in decline, we approximate the decline
in <em>thylacine</em> habitat suitability by applying a constant annual
decline to all IBRA bioregions except Tasmanian West (5) and Central
Highlands (8), which have mostly retained natural ecosystems.</p>
</div>
<div class="section level5">
<h5 id="initial-abundance-and-carrying-capacity-generator">Initial abundance and carrying capacity generator<a class="anchor" aria-label="anchor" href="#initial-abundance-and-carrying-capacity-generator"></a>
</h5>
<p>We will utilize <em>Generator</em> class functionality for creating
user-defined (template) functions to generate initial abundance and
carrying capacity (outputs). The functions will use the initial habitat
suitability and spatial distribution of habitat decline, along with
sampled values (inputs) for initial carrying capacity, percentage
decline (in 7/9 IBRA bioregions), and the fraction of capacity for
initial abundance (phi).</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Build a carrying capacity generator model based on habitat suitability and sampled</span></span>
<span><span class="co"># initial capacity, initial fraction (phi), &amp; decline rate per year in selected bioregions.</span></span>
<span><span class="va">capacity_gen</span> <span class="op">&lt;-</span> <span class="va"><a href="../reference/Generator.html">Generator</a></span><span class="op">$</span><span class="fu">new</span><span class="op">(</span></span>
<span>  description <span class="op">=</span> <span class="st">"capacity"</span>,</span>
<span>  time_steps <span class="op">=</span> <span class="fl">80</span>, <span class="co"># years (1888-1967)</span></span>
<span>  initial_hs <span class="op">=</span> <span class="va">thylacine_hs_raster</span><span class="op">[</span><span class="va">region</span><span class="op">$</span><span class="va">region_indices</span><span class="op">]</span>,</span>
<span>  decline_indices <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/which.html" class="external-link">which</a></span><span class="op">(</span><span class="op">!</span><span class="va">tasmania_ibra_raster</span><span class="op">[</span><span class="va">region</span><span class="op">$</span><span class="va">region_indices</span><span class="op">]</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">5</span>, <span class="fl">8</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  inputs <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"k_init"</span>, <span class="st">"k_decline"</span>, <span class="st">"k_phi"</span><span class="op">)</span>,</span>
<span>  outputs <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"initial_abundance"</span>, <span class="st">"carrying_capacity"</span><span class="op">)</span>,</span>
<span>  generative_requirements <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>    initial_abundance <span class="op">=</span> <span class="st">"function"</span>,</span>
<span>    carrying_capacity <span class="op">=</span> <span class="st">"function"</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="va">capacity_gen</span><span class="op">$</span><span class="fu">add_function_template</span><span class="op">(</span></span>
<span>  <span class="st">"initial_abundance"</span>,</span>
<span>  function_def <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">params</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">distr_k</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="va">params</span><span class="op">$</span><span class="va">initial_hs</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">params</span><span class="op">$</span><span class="va">initial_hs</span><span class="op">)</span> <span class="op">*</span> <span class="va">params</span><span class="op">$</span><span class="va">k_init</span><span class="op">)</span></span>
<span>    <span class="va">a_init</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="va">params</span><span class="op">$</span><span class="va">k_init</span> <span class="op">*</span> <span class="va">params</span><span class="op">$</span><span class="va">k_phi</span><span class="op">)</span> <span class="co"># total initial</span></span>
<span>    <span class="va">distr_a</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/array.html" class="external-link">array</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">distr_k</span><span class="op">)</span><span class="op">)</span></span>
<span>    <span class="va">rep_indices</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/unlist.html" class="external-link">unlist</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/apply.html" class="external-link">apply</a></span><span class="op">(</span></span>
<span>      <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">distr_k</span><span class="op">)</span><span class="op">)</span>, <span class="fl">1</span>,</span>
<span>      <span class="kw">function</span><span class="op">(</span><span class="va">i</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="va">i</span>, <span class="va">distr_k</span><span class="op">[</span><span class="va">i</span><span class="op">]</span><span class="op">)</span></span>
<span>    <span class="op">)</span><span class="op">)</span></span>
<span>    <span class="va">sample_indices</span> <span class="op">&lt;-</span> <span class="va">rep_indices</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span></span>
<span>      <span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">rep_indices</span><span class="op">)</span>,</span>
<span>      <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">min</a></span><span class="op">(</span><span class="va">a_init</span>, <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">rep_indices</span><span class="op">)</span><span class="op">)</span></span>
<span>    <span class="op">)</span><span class="op">]</span></span>
<span>    <span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="va">sample_indices</span><span class="op">)</span> <span class="va">distr_a</span><span class="op">[</span><span class="va">i</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">distr_a</span><span class="op">[</span><span class="va">i</span><span class="op">]</span> <span class="op">+</span> <span class="fl">1</span></span>
<span>    <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="va">distr_a</span><span class="op">)</span></span>
<span>  <span class="op">}</span>,</span>
<span>  call_params <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"initial_hs"</span>, <span class="st">"k_init"</span>, <span class="st">"k_phi"</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="va">capacity_gen</span><span class="op">$</span><span class="fu">add_function_template</span><span class="op">(</span></span>
<span>  <span class="st">"carrying_capacity"</span>,</span>
<span>  function_def <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">params</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">distr_k</span> <span class="op">&lt;-</span> <span class="va">params</span><span class="op">$</span><span class="va">initial_hs</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">params</span><span class="op">$</span><span class="va">initial_hs</span><span class="op">)</span> <span class="op">*</span> <span class="va">params</span><span class="op">$</span><span class="va">k_init</span></span>
<span>    <span class="va">decline_matrix</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/array.html" class="external-link">array</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">distr_k</span><span class="op">)</span>, <span class="va">params</span><span class="op">$</span><span class="va">time_steps</span><span class="op">)</span><span class="op">)</span></span>
<span>    <span class="va">decline_matrix</span><span class="op">[</span><span class="va">params</span><span class="op">$</span><span class="va">decline_indices</span>, <span class="op">]</span> <span class="op">&lt;-</span></span>
<span>      <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="op">(</span><span class="fl">1</span> <span class="op">-</span> <span class="va">params</span><span class="op">$</span><span class="va">k_decline</span><span class="op">)</span><span class="op">^</span><span class="op">(</span><span class="fl">0</span><span class="op">:</span><span class="op">(</span><span class="va">params</span><span class="op">$</span><span class="va">time_steps</span> <span class="op">-</span> <span class="fl">1</span><span class="op">)</span><span class="op">)</span>,</span>
<span>        nrow <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">params</span><span class="op">$</span><span class="va">decline_indices</span><span class="op">)</span>, ncol <span class="op">=</span> <span class="va">params</span><span class="op">$</span><span class="va">time_steps</span>,</span>
<span>        byrow <span class="op">=</span> <span class="cn">TRUE</span></span>
<span>      <span class="op">)</span></span>
<span>    <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="va">distr_k</span> <span class="op">*</span> <span class="va">decline_matrix</span><span class="op">)</span></span>
<span>  <span class="op">}</span>,</span>
<span>  call_params <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span></span>
<span>    <span class="st">"initial_hs"</span>, <span class="st">"time_steps"</span>, <span class="st">"decline_indices"</span>,</span>
<span>    <span class="st">"k_init"</span>, <span class="st">"k_decline"</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>We can test our generator with some example (mid-value) sample inputs
and examine plots of the output initial abundance and carrying capacity
(final).</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Generate example initial abundance and declining carrying capacity time-series</span></span>
<span><span class="va">generated_k</span> <span class="op">&lt;-</span> <span class="va">capacity_gen</span><span class="op">$</span><span class="fu">generate</span><span class="op">(</span>input_values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>  k_init <span class="op">=</span> <span class="fl">2800</span>,</span>
<span>  k_decline <span class="op">=</span> <span class="fl">0.04</span>,</span>
<span>  k_phi <span class="op">=</span> <span class="fl">0.8</span></span>
<span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">example_initial_abundance</span> <span class="op">&lt;-</span> <span class="va">generated_k</span><span class="op">$</span><span class="va">initial_abundance</span></span>
<span><span class="va">example_carrying_capacity</span> <span class="op">&lt;-</span> <span class="va">generated_k</span><span class="op">$</span><span class="va">carrying_capacity</span></span>
<span></span>
<span><span class="co"># Plot the example initial abundance</span></span>
<span><span class="va">example_initial_n_raster</span> <span class="op">&lt;-</span> <span class="va">region</span><span class="op">$</span><span class="va">region_raster</span></span>
<span><span class="va">example_initial_n_raster</span><span class="op">[</span><span class="va">region</span><span class="op">$</span><span class="va">region_indices</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">example_initial_abundance</span></span>
<span><span class="fu">raster</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/base/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">example_initial_n_raster</span>,</span>
<span>  main <span class="op">=</span> <span class="st">"Example initial thylacines"</span>,</span>
<span>  colNA <span class="op">=</span> <span class="st">"blue"</span>, xlab <span class="op">=</span> <span class="st">"Longitude (degrees)"</span>, ylab <span class="op">=</span> <span class="st">"Latitude (degrees)"</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p><img src="thylacine_example_files/figure-html/unnamed-chunk-12-1.png" width="480" style="display: block; margin: auto;"></p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="co"># Plot the example final carrying capacity</span></span>
<span><span class="va">example_final_raster</span> <span class="op">&lt;-</span> <span class="va">region</span><span class="op">$</span><span class="va">region_raster</span></span>
<span><span class="va">example_final_raster</span><span class="op">[</span><span class="va">region</span><span class="op">$</span><span class="va">region_indices</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">example_carrying_capacity</span><span class="op">[</span>, <span class="fl">80</span><span class="op">]</span></span>
<span><span class="fu">raster</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/base/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">example_final_raster</span>,</span>
<span>  main <span class="op">=</span> <span class="st">"Final thylacine carrying capacity"</span>,</span>
<span>  colNA <span class="op">=</span> <span class="st">"blue"</span>, xlab <span class="op">=</span> <span class="st">"Longitude (degrees)"</span>, ylab <span class="op">=</span> <span class="st">"Latitude (degrees)"</span>,</span>
<span>  zlim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">8</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p><img src="thylacine_example_files/figure-html/unnamed-chunk-12-2.png" width="480" style="display: block; margin: auto;"></p>
</div>
<div class="section level5">
<h5 id="stage-matrix-generator">Stage matrix generator<a class="anchor" aria-label="anchor" href="#stage-matrix-generator"></a>
</h5>
<p>Our stage matrix generator adjusts our original stage matrix so that
its equivalent (simple) growth rate (<em>lambda</em> - 1) is that of a
sampled input rate.</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Build a stage matrix generator based on sampled growth rate</span></span>
<span><span class="va">stage_matrix_gen</span> <span class="op">&lt;-</span> <span class="va"><a href="../reference/Generator.html">Generator</a></span><span class="op">$</span><span class="fu">new</span><span class="op">(</span></span>
<span>  description <span class="op">=</span> <span class="st">"stage matrix"</span>,</span>
<span>  base_matrix <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span></span>
<span>    <span class="fl">0.00</span>, <span class="fl">0.57</span>, <span class="fl">1.17</span>,</span>
<span>    <span class="fl">0.50</span>, <span class="fl">0.00</span>, <span class="fl">0.00</span>,</span>
<span>    <span class="fl">0.00</span>, <span class="fl">0.80</span>, <span class="fl">0.80</span></span>
<span>  <span class="op">)</span>, nrow <span class="op">=</span> <span class="fl">3</span>, ncol <span class="op">=</span> <span class="fl">3</span>, byrow <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>,</span>
<span>  inputs <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"growth_r"</span><span class="op">)</span>,</span>
<span>  outputs <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"stage_matrix"</span><span class="op">)</span>,</span>
<span>  generative_requirements <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>stage_matrix <span class="op">=</span> <span class="st">"function"</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="va">stage_matrix_gen</span><span class="op">$</span><span class="fu">add_function_template</span><span class="op">(</span></span>
<span>  <span class="st">"stage_matrix"</span>,</span>
<span>  function_def <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">params</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="va">params</span><span class="op">$</span><span class="va">base_matrix</span> <span class="op">*</span> <span class="op">(</span><span class="fl">1</span> <span class="op">+</span> <span class="va">params</span><span class="op">$</span><span class="va">growth_r</span><span class="op">)</span> <span class="op">/</span></span>
<span>      <span class="fu"><a href="https://rdrr.io/r/base/complex.html" class="external-link">Re</a></span><span class="op">(</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/eigen.html" class="external-link">eigen</a></span><span class="op">(</span><span class="va">params</span><span class="op">$</span><span class="va">base_matrix</span><span class="op">)</span><span class="op">$</span><span class="va">values</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="op">}</span>,</span>
<span>  call_params <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"base_matrix"</span>, <span class="st">"growth_r"</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>We can test our generator with an example (mid-value) sample input
growth rate of 0.25 (<em>lambda</em> = 1.25).</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Generate sampled stage matrix for growth rate: lambda = 1.25</span></span>
<span><span class="va">gen_stage_m</span> <span class="op">&lt;-</span> <span class="va">stage_matrix_gen</span><span class="op">$</span><span class="fu">generate</span><span class="op">(</span>input_values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>growth_r <span class="op">=</span> <span class="fl">0.25</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">gen_stage_m</span> <span class="co"># examine</span></span>
<span><span class="co">#&gt; $stage_matrix</span></span>
<span><span class="co">#&gt;           [,1]      [,2]      [,3]</span></span>
<span><span class="co">#&gt; [1,] 0.0000000 0.5923549 1.2158863</span></span>
<span><span class="co">#&gt; [2,] 0.5196095 0.0000000 0.0000000</span></span>
<span><span class="co">#&gt; [3,] 0.0000000 0.8313752 0.8313752</span></span></code></pre></div>
</div>
<div class="section level5">
<h5 id="dispersal-generator">Dispersal generator<a class="anchor" aria-label="anchor" href="#dispersal-generator"></a>
</h5>
<p>We already built our dispersal generator in step 1, so as to use it
to calculate neighborhood distances for density dependence. Our
distance-based dispersal generator will use sampled values for the
dispersal proportion (<em>p</em>) and breadth (<em>b</em>) parameters,
which are described in the generator’s help documentation
(<em>?DispersalGenerator</em>). We will now use it to generate some
example dispersal data, based on our best estimates for the <em>p</em>
and <em>b</em> parameters.</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Generate sampled dispersals for p = 0.5, b = 7 (km)</span></span>
<span><span class="va">sample_dispersal_data</span> <span class="op">&lt;-</span> <span class="va">dispersal_gen</span><span class="op">$</span><span class="fu">generate</span><span class="op">(</span></span>
<span>  input_values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>dispersal_p <span class="op">=</span> <span class="fl">0.5</span>, dispersal_b <span class="op">=</span> <span class="fl">7</span><span class="op">)</span></span>
<span><span class="op">)</span><span class="op">$</span><span class="va">dispersal_data</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">sample_dispersal_data</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">)</span> <span class="co"># examine</span></span>
<span><span class="co">#&gt;   target_pop source_pop emigrant_row immigrant_row dispersal_rate</span></span>
<span><span class="co">#&gt; 1          2          1            1             1        0.13164</span></span>
<span><span class="co">#&gt; 2          3          1            2             1        0.04198</span></span>
<span><span class="co">#&gt; 3          4          1            3             1        0.01161</span></span>
<span><span class="co">#&gt; 4          5          1            4             1        0.06444</span></span>
<span><span class="co">#&gt; 5          6          1            5             1        0.08576</span></span>
<span><span class="co">#&gt; 6          7          1            6             1        0.06444</span></span></code></pre></div>
</div>
</div>
<div class="section level3">
<h3 id="example-model-run">Example model run<a class="anchor" aria-label="anchor" href="#example-model-run"></a>
</h3>
<p>Before proceeding to step 3 to setup multiple model simulations,
let’s run our model with its fixed parameter values, those initially set
in our user-defined density dependence and harvest functions, along with
our generated example initial abundance, carrying capacity, stage
matrix, and dispersal data. We will do this by cloning our model
template and setting our example parameters before running the
population simulator.</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Run the model with example parameters</span></span>
<span><span class="va">model</span> <span class="op">&lt;-</span> <span class="va">model_template</span><span class="op">$</span><span class="fu">clone</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">model</span><span class="op">$</span><span class="fu">set_attributes</span><span class="op">(</span></span>
<span>  initial_abundance <span class="op">=</span> <span class="va">example_initial_abundance</span>,</span>
<span>  carrying_capacity <span class="op">=</span> <span class="va">example_carrying_capacity</span>,</span>
<span>  stage_matrix <span class="op">=</span> <span class="va">gen_stage_m</span><span class="op">$</span><span class="va">stage_matrix</span>,</span>
<span>  dispersal <span class="op">=</span> <span class="va">sample_dispersal_data</span></span>
<span><span class="op">)</span></span>
<span><span class="va">results</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/population_simulator.html">population_simulator</a></span><span class="op">(</span><span class="va">model</span><span class="op">)</span> <span class="co"># run poems simulator</span></span>
<span></span>
<span><span class="co"># Plot the total abundance and number harvested</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span></span>
<span>  x <span class="op">=</span> <span class="fl">1888</span><span class="op">:</span><span class="fl">1967</span>, y <span class="op">=</span> <span class="va">results</span><span class="op">$</span><span class="va">all</span><span class="op">$</span><span class="va">abundance</span>, xlab <span class="op">=</span> <span class="st">"Year"</span>,</span>
<span>  ylab <span class="op">=</span> <span class="st">"Number of thylacines"</span>, main <span class="op">=</span> <span class="st">"Thylacine example model run"</span>,</span>
<span>  ylim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">2500</span><span class="op">)</span>, type <span class="op">=</span> <span class="st">"l"</span>, col <span class="op">=</span> <span class="st">"green"</span>, lwd <span class="op">=</span> <span class="fl">2</span></span>
<span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/lines.html" class="external-link">lines</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fl">1888</span><span class="op">:</span><span class="fl">1967</span>, y <span class="op">=</span> <span class="va">results</span><span class="op">$</span><span class="va">all</span><span class="op">$</span><span class="va">harvested</span>, lty <span class="op">=</span> <span class="fl">1</span>, col <span class="op">=</span> <span class="st">"blue"</span>, lwd <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/legend.html" class="external-link">legend</a></span><span class="op">(</span><span class="st">"topright"</span>,</span>
<span>  legend <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Population size"</span>, <span class="st">"Simulated harvest"</span><span class="op">)</span>,</span>
<span>  col <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"green"</span>, <span class="st">"blue"</span><span class="op">)</span>, lty <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">1</span><span class="op">)</span>, lwd <span class="op">=</span> <span class="fl">2</span>, cex <span class="op">=</span> <span class="fl">0.8</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p><img src="thylacine_example_files/figure-html/unnamed-chunk-16-1.png" width="672" style="display: block; margin: auto;"></p>
</div>
<div class="section level3">
<h3 id="step-3-sample-model-and-generator-parameters-for-each-simulation">Step 3: Sample model and generator parameters for each
simulation<a class="anchor" aria-label="anchor" href="#step-3-sample-model-and-generator-parameters-for-each-simulation"></a>
</h3>
<p>In order to explore the model parameter space to find the best
models, we will now generate 20,000 Latin hypercube samples of model and
generator parameters using the <em>LatinHypercubeSampler</em> class.
We’ll sample each parameter from uniform distributions across parameter
ranges derived from Bulte et al. (2003), and via model trial runs.</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Create a LHS object</span></span>
<span><span class="va">lhs_gen</span> <span class="op">&lt;-</span> <span class="va"><a href="../reference/LatinHypercubeSampler.html">LatinHypercubeSampler</a></span><span class="op">$</span><span class="fu">new</span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Set capacity and growth parameters (as per Bulte et al., 2003)</span></span>
<span><span class="va">lhs_gen</span><span class="op">$</span><span class="fu">set_uniform_parameter</span><span class="op">(</span><span class="st">"k_init"</span>, lower <span class="op">=</span> <span class="fl">2100</span>, upper <span class="op">=</span> <span class="fl">3500</span>, decimals <span class="op">=</span> <span class="fl">0</span><span class="op">)</span></span>
<span><span class="va">lhs_gen</span><span class="op">$</span><span class="fu">set_uniform_parameter</span><span class="op">(</span><span class="st">"k_decline"</span>, lower <span class="op">=</span> <span class="fl">0.03</span>, upper <span class="op">=</span> <span class="fl">0.05</span>, decimals <span class="op">=</span> <span class="fl">3</span><span class="op">)</span></span>
<span><span class="va">lhs_gen</span><span class="op">$</span><span class="fu">set_uniform_parameter</span><span class="op">(</span><span class="st">"k_phi"</span>, lower <span class="op">=</span> <span class="fl">0.6</span>, upper <span class="op">=</span> <span class="fl">1.0</span>, decimals <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span>
<span><span class="va">lhs_gen</span><span class="op">$</span><span class="fu">set_uniform_parameter</span><span class="op">(</span><span class="st">"growth_r"</span>, lower <span class="op">=</span> <span class="fl">0.1875</span>, upper <span class="op">=</span> <span class="fl">0.3125</span>, decimals <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Set density dependence allee effect parameter</span></span>
<span><span class="va">lhs_gen</span><span class="op">$</span><span class="fu">set_uniform_parameter</span><span class="op">(</span><span class="st">"density_allee"</span>, lower <span class="op">=</span> <span class="fl">0</span>, upper <span class="op">=</span> <span class="fl">50</span>, decimals <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Set bio-economic harvest parameters (as per Bulte et al., 2003)</span></span>
<span><span class="va">lhs_gen</span><span class="op">$</span><span class="fu">set_uniform_parameter</span><span class="op">(</span><span class="st">"harvest_ohr"</span>, lower <span class="op">=</span> <span class="fl">0</span>, upper <span class="op">=</span> <span class="fl">0.1</span>, decimals <span class="op">=</span> <span class="fl">3</span><span class="op">)</span></span>
<span><span class="va">lhs_gen</span><span class="op">$</span><span class="fu">set_uniform_parameter</span><span class="op">(</span><span class="st">"harvest_fb"</span>, lower <span class="op">=</span> <span class="fl">0.5</span>, upper <span class="op">=</span> <span class="fl">1.0</span>, decimals <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span>
<span><span class="va">lhs_gen</span><span class="op">$</span><span class="fu">set_uniform_parameter</span><span class="op">(</span><span class="st">"harvest_w"</span>, lower <span class="op">=</span> <span class="fl">2.625</span>, upper <span class="op">=</span> <span class="fl">4.375</span>, decimals <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span>
<span><span class="va">lhs_gen</span><span class="op">$</span><span class="fu">set_uniform_parameter</span><span class="op">(</span><span class="st">"harvest_E0"</span>, lower <span class="op">=</span> <span class="fl">18.75</span>, upper <span class="op">=</span> <span class="fl">31.25</span>, decimals <span class="op">=</span> <span class="fl">0</span><span class="op">)</span></span>
<span><span class="va">lhs_gen</span><span class="op">$</span><span class="fu">set_uniform_parameter</span><span class="op">(</span><span class="st">"harvest_q"</span>, lower <span class="op">=</span> <span class="fl">0</span>, upper <span class="op">=</span> <span class="fl">0.005</span>, decimals <span class="op">=</span> <span class="fl">4</span><span class="op">)</span></span>
<span><span class="va">lhs_gen</span><span class="op">$</span><span class="fu">set_uniform_parameter</span><span class="op">(</span><span class="st">"harvest_v1"</span>, lower <span class="op">=</span> <span class="fl">0.015</span>, upper <span class="op">=</span> <span class="fl">0.025</span>, decimals <span class="op">=</span> <span class="fl">3</span><span class="op">)</span></span>
<span><span class="va">lhs_gen</span><span class="op">$</span><span class="fu">set_uniform_parameter</span><span class="op">(</span><span class="st">"harvest_v2"</span>, lower <span class="op">=</span> <span class="fl">0.375</span>, upper <span class="op">=</span> <span class="fl">0.625</span>, decimals <span class="op">=</span> <span class="fl">3</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Set new spatial parameters for dispersal</span></span>
<span><span class="va">lhs_gen</span><span class="op">$</span><span class="fu">set_uniform_parameter</span><span class="op">(</span><span class="st">"dispersal_p"</span>, lower <span class="op">=</span> <span class="fl">0.3</span>, upper <span class="op">=</span> <span class="fl">0.7</span>, decimals <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span>
<span><span class="va">lhs_gen</span><span class="op">$</span><span class="fu">set_uniform_parameter</span><span class="op">(</span><span class="st">"dispersal_b"</span>, lower <span class="op">=</span> <span class="fl">4</span>, upper <span class="op">=</span> <span class="fl">10</span>, decimals <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Generate samples</span></span>
<span><span class="va">sample_data</span> <span class="op">&lt;-</span> <span class="va">lhs_gen</span><span class="op">$</span><span class="fu">generate_samples</span><span class="op">(</span>number <span class="op">=</span> <span class="va">SAMPLES</span>, random_seed <span class="op">=</span> <span class="fl">123</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">sample_data</span><span class="op">)</span> <span class="co"># examine</span></span>
<span><span class="co">#&gt;   k_init k_decline k_phi growth_r density_allee harvest_ohr harvest_fb</span></span>
<span><span class="co">#&gt; 1   3451     0.050  0.67     0.27          46.1       0.016       0.64</span></span>
<span><span class="co">#&gt; 2   3208     0.048  0.80     0.28           1.0       0.052       0.50</span></span>
<span><span class="co">#&gt; 3   2375     0.033  0.96     0.29          30.9       0.072       0.76</span></span>
<span><span class="co">#&gt; 4   2733     0.042  0.87     0.25          23.5       0.057       0.63</span></span>
<span><span class="co">#&gt; 5   3048     0.040  0.64     0.19          46.4       0.074       0.74</span></span>
<span><span class="co">#&gt; 6   3250     0.031  0.76     0.21          38.5       0.081       0.99</span></span>
<span><span class="co">#&gt;   harvest_w harvest_E0 harvest_q harvest_v1 harvest_v2 dispersal_p dispersal_b</span></span>
<span><span class="co">#&gt; 1       3.3         30    0.0025      0.020      0.555        0.59         5.5</span></span>
<span><span class="co">#&gt; 2       2.9         23    0.0009      0.017      0.534        0.33         5.1</span></span>
<span><span class="co">#&gt; 3       3.8         29    0.0023      0.019      0.406        0.68         8.1</span></span>
<span><span class="co">#&gt; 4       4.0         26    0.0008      0.017      0.510        0.54         4.8</span></span>
<span><span class="co">#&gt; 5       3.1         21    0.0049      0.019      0.444        0.54         5.0</span></span>
<span><span class="co">#&gt; 6       2.9         24    0.0021      0.016      0.463        0.57         6.7</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/dim.html" class="external-link">dim</a></span><span class="op">(</span><span class="va">sample_data</span><span class="op">)</span> <span class="co"># dimensions</span></span>
<span><span class="co">#&gt; [1] 20000    14</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="step-4-build-a-simulation-manager-to-run-each-simulation">Step 4: Build a simulation manager to run each simulation<a class="anchor" aria-label="anchor" href="#step-4-build-a-simulation-manager-to-run-each-simulation"></a>
</h3>
<p>We will now setup a <em>SimulationManager</em> class to manage the
simulation of each set (or row) of sampled parameters. In demonstration
mode we will only run the simulations for the first two samples. The
<em>poems</em> package provides example simulation summary data for all
20,000 samples (which is used in our model ensemble selection and
validation).</p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Build the simulation manager</span></span>
<span><span class="va">sim_manager</span> <span class="op">&lt;-</span> <span class="va"><a href="../reference/SimulationManager.html">SimulationManager</a></span><span class="op">$</span><span class="fu">new</span><span class="op">(</span></span>
<span>  sample_data <span class="op">=</span> <span class="va">sample_data</span>,</span>
<span>  model_template <span class="op">=</span> <span class="va">model_template</span>,</span>
<span>  generators <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">capacity_gen</span>, <span class="va">stage_matrix_gen</span>, <span class="va">dispersal_gen</span><span class="op">)</span>,</span>
<span>  parallel_cores <span class="op">=</span> <span class="va">PARALLEL_CORES</span>,</span>
<span>  results_dir <span class="op">=</span> <span class="va">OUTPUT_DIR</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Run the simulations</span></span>
<span><span class="kw">if</span> <span class="op">(</span><span class="va">DEMONSTRATION</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">sim_manager</span><span class="op">$</span><span class="va">sample_data</span> <span class="op">&lt;-</span> <span class="va">sample_data</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">2</span>, <span class="op">]</span></span>
<span><span class="op">}</span></span>
<span><span class="va">run_output</span> <span class="op">&lt;-</span> <span class="va">sim_manager</span><span class="op">$</span><span class="fu">run</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">run_output</span><span class="op">$</span><span class="va">summary</span></span>
<span><span class="co">#&gt; [1] "2 of 2 sample models ran and saved results successfully"</span></span>
<span><span class="kw">if</span> <span class="op">(</span><span class="va">DEMONSTRATION</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/list.files.html" class="external-link">dir</a></span><span class="op">(</span><span class="va">OUTPUT_DIR</span>, <span class="st">"*.RData"</span><span class="op">)</span> <span class="co"># includes 2 result files</span></span>
<span><span class="op">}</span></span>
<span><span class="co">#&gt; [1] "sample_1_results.RData" "sample_2_results.RData"</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/list.files.html" class="external-link">dir</a></span><span class="op">(</span><span class="va">OUTPUT_DIR</span>, <span class="st">"*.txt"</span><span class="op">)</span> <span class="co"># plus simulation log</span></span>
<span><span class="co">#&gt; [1] "simulation_log.txt"</span></span></code></pre></div>
<p>Note that the output directory contains a R-data result files for
each sample simulation and a simulation log file.</p>
</div>
<div class="section level3">
<h3 id="step-5-build-a-results-manager-to-generate-summary-results-metrics">Step 5: Build a results manager to generate summary results
(metrics)<a class="anchor" aria-label="anchor" href="#step-5-build-a-results-manager-to-generate-summary-results-metrics"></a>
</h3>
<p>We will now collate summary result metrics for each of our
simulations using the <em>ResultsManager</em> class. Here we will
generate three metrics: 1. Regression slopes of total bounty submitted
over three time intervals. 1. Estimated IBRA bioregion extirpation
dates. 1. Estimated Tasmania-wide extinction date. The metrics (and any
desired summary matrices) are calculated via user-defined functions
operating on, or direct attributes of, <em>PopulationResults</em> class
objects.</p>
<div class="section level5">
<h5 id="using-the-populationresults-class">Using the <em>PopulationResults</em> class<a class="anchor" aria-label="anchor" href="#using-the-populationresults-class"></a>
</h5>
<p>To setup and test our summary metric functions, we can load the
results from our example simulation run into a
<em>PopulationResults</em> class object. A time-series of IBRA bioregion
bounty values are attached to our results via our harvest function. This
can be used to calculate the regression slopes for specified intervals.
To obtain a time-series of bioregion abundance values, we can include
the bioregion cell indices in our result class object (as an
attachment). We can then use this to calculate a time-series of
abundance for each bioregion, and thus calculate extirpation times for
each bioregion. We will use <em>PopulationResults</em> functionality for
calculating population (cell) abundance slopes (trends) and extirpations
via result object cloning. Our clones will instead be initialized with
the bounty or bioregion abundance values. The Tasmania-wide extinction
time is directly available from the results object.</p>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Load our results (list) into a PopulationResults object</span></span>
<span><span class="va">p_results</span> <span class="op">&lt;-</span> <span class="va"><a href="../reference/PopulationResults.html">PopulationResults</a></span><span class="op">$</span><span class="fu">new</span><span class="op">(</span></span>
<span>  results <span class="op">=</span> <span class="va">results</span>,</span>
<span>  ibra_indices <span class="op">=</span> <span class="va">ibra_indices</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Summary metrics for IBRA bioregions and Tasmania-wide extinction</span></span>
<span><span class="va">ibra_bounty</span> <span class="op">&lt;-</span> <span class="va">p_results</span><span class="op">$</span><span class="fu">get_attribute</span><span class="op">(</span><span class="st">"bounty"</span><span class="op">)</span> <span class="co"># saved in harvest function</span></span>
<span><span class="va">ibra_bounty_clone</span> <span class="op">&lt;-</span> <span class="va">p_results</span><span class="op">$</span><span class="fu">new_clone</span><span class="op">(</span></span>
<span>  results <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>abundance <span class="op">=</span> <span class="va">ibra_bounty</span><span class="op">)</span>,</span>
<span>  trend_interval <span class="op">=</span> <span class="op">(</span><span class="fl">1888</span><span class="op">:</span><span class="fl">1894</span><span class="op">)</span> <span class="op">-</span> <span class="fl">1887</span></span>
<span><span class="op">)</span></span>
<span><span class="va">ibra_bounty_clone</span><span class="op">$</span><span class="va">all</span><span class="op">$</span><span class="va">abundance_trend</span> <span class="co"># 1888-1894 total bounty slope</span></span>
<span><span class="co">#&gt; [1] -4</span></span>
<span><span class="va">ibra_abundance</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/t.html" class="external-link">t</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/array.html" class="external-link">array</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/unlist.html" class="external-link">unlist</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span></span>
<span>  <span class="va">p_results</span><span class="op">$</span><span class="fu">get_attribute</span><span class="op">(</span><span class="st">"ibra_indices"</span><span class="op">)</span>,</span>
<span>  <span class="kw">function</span><span class="op">(</span><span class="va">indices</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/colSums.html" class="external-link">colSums</a></span><span class="op">(</span><span class="va">p_results</span><span class="op">$</span><span class="va">abundance</span><span class="op">[</span><span class="va">indices</span>, <span class="op">]</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span><span class="op">)</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">80</span>, <span class="fl">9</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">ibra_abundance_clone</span> <span class="op">&lt;-</span> <span class="va">p_results</span><span class="op">$</span><span class="fu">new_clone</span><span class="op">(</span>results <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>abundance <span class="op">=</span> <span class="va">ibra_abundance</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">(</span><span class="fl">1888</span><span class="op">:</span><span class="fl">1967</span><span class="op">)</span><span class="op">[</span><span class="va">ibra_abundance_clone</span><span class="op">$</span><span class="va">extirpation</span><span class="op">]</span> <span class="co"># IBRA extirpation</span></span>
<span><span class="co">#&gt; [1] 1925 1927 1921 1934 1935 1932 1933 1934 1932</span></span>
<span><span class="op">(</span><span class="fl">1888</span><span class="op">:</span><span class="fl">1967</span><span class="op">)</span><span class="op">[</span><span class="va">p_results</span><span class="op">$</span><span class="va">all</span><span class="op">$</span><span class="va">extirpation</span><span class="op">]</span> <span class="co"># total extinction</span></span>
<span><span class="co">#&gt; [1] 1935</span></span></code></pre></div>
</div>
<div class="section level5">
<h5 id="generating-summary-metrics-and-matrices">Generating summary metrics and matrices<a class="anchor" aria-label="anchor" href="#generating-summary-metrics-and-matrices"></a>
</h5>
<p>Once we’re happy with how to derive our summary metrics (and
matrices) via the <em>PopulationResults</em> class, we can setup our
results manager to generate the metrics and matrix (rows) for each
sample simulation results (file). Note that passing the simulation
manager when initializing the results manager copies the previous setup
(sample data, output directory, etc.).</p>
<p>Our bounty regression slope and IBRA bioregion extirpation metrics
can be combined into single metrics by calculating the square root of
the mean square error (RMSE) of the simulated metrics from known or
derived target values, or confidence intervals (CI), for each time
interval or bioregion. Thus our targets for each of these RMSE metrics
(in step 6) will be zero. We can calculate these combined (RMSE) metrics
using our results manager by including (or attaching) the target
values/CI to our results object. However, if we wish to retain
flexibility in how we combine our individual metrics, or how we deal
with <em>NA</em> values (e.g. no extirpation) in step 6, we can
alternatively store our metrics for each slope interval or bioregion in
generated matrix rows and calculate the difference with targets later.
Here we will demonstrate both approaches, although the matrix approach
requires more disk space.</p>
<p>In demonstration mode, we will again only generate metrics for the
first two samples. We will load pre-generated example summaries for all
20,000 sample simulations, provided with the <em>poems</em> package
prior to our validation and ensemble selection (in step 6).</p>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Set targets for our summary metrics (used to calculate combined metric errors)</span></span>
<span><span class="va">slope_intervals</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"1888-1894"</span>, <span class="st">"1895-1901"</span>, <span class="st">"1902-1909"</span><span class="op">)</span></span>
<span><span class="va">targets</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>  bounty_slope <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/array.html" class="external-link">array</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2.36</span>, <span class="fl">3.25</span>, <span class="op">-</span><span class="fl">17.71</span><span class="op">)</span>, dimnames <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">slope_intervals</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  ibra_extirpation <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/array.html" class="external-link">array</a></span><span class="op">(</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span></span>
<span>      <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="cn">NA</span>, <span class="cn">NA</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1934</span>, <span class="fl">1934</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1912</span>, <span class="fl">1919</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1921</span>, <span class="fl">1940</span><span class="op">)</span>,</span>
<span>      <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1936</span>, <span class="fl">1938</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1935</span>, <span class="fl">1935</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1934</span>, <span class="fl">1942</span><span class="op">)</span>,</span>
<span>      <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1934</span>, <span class="fl">1934</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1932</span>, <span class="fl">1932</span><span class="op">)</span></span>
<span>    <span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2</span>, <span class="fl">9</span><span class="op">)</span>,</span>
<span>    dimnames <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"lower"</span>, <span class="st">"upper"</span><span class="op">)</span>, <span class="va">tasmania_ibra_data</span><span class="op">$</span><span class="va">abbr</span><span class="op">)</span></span>
<span>  <span class="op">)</span>,</span>
<span>  total_extinction <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>lower <span class="op">=</span> <span class="fl">1936</span>, upper <span class="op">=</span> <span class="fl">1942</span><span class="op">)</span> <span class="co"># CI</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Create a results manager for summary metrics and matrices</span></span>
<span><span class="va">results_manager</span> <span class="op">&lt;-</span> <span class="va"><a href="../reference/ResultsManager.html">ResultsManager</a></span><span class="op">$</span><span class="fu">new</span><span class="op">(</span></span>
<span>  simulation_manager <span class="op">=</span> <span class="va">sim_manager</span>,</span>
<span>  simulation_results <span class="op">=</span> <span class="va"><a href="../reference/PopulationResults.html">PopulationResults</a></span><span class="op">$</span><span class="fu">new</span><span class="op">(</span></span>
<span>    ibra_indices <span class="op">=</span> <span class="va">ibra_indices</span>, <span class="co"># attachments</span></span>
<span>    targets <span class="op">=</span> <span class="va">targets</span>,</span>
<span>    extirp_NA_replace <span class="op">=</span> <span class="fl">1968</span></span>
<span>  <span class="op">)</span>,</span>
<span>  result_attachment_functions <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span> <span class="co"># attached for multiple use</span></span>
<span>    bounty_slope <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">results</span><span class="op">)</span> <span class="op">{</span> <span class="co"># via results object cloning</span></span>
<span>      <span class="va">bounty_slope</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/array.html" class="external-link">array</a></span><span class="op">(</span><span class="cn">NA</span>, <span class="fl">3</span><span class="op">)</span></span>
<span>      <span class="va">ibra_bounty</span> <span class="op">&lt;-</span> <span class="va">results</span><span class="op">$</span><span class="fu">get_attribute</span><span class="op">(</span><span class="st">"bounty"</span><span class="op">)</span> <span class="co"># saved in harvest function</span></span>
<span>      <span class="va">ibra_bounty_clone</span> <span class="op">&lt;-</span> <span class="va">results</span><span class="op">$</span><span class="fu">new_clone</span><span class="op">(</span></span>
<span>        results <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>abundance <span class="op">=</span> <span class="va">ibra_bounty</span><span class="op">)</span>,</span>
<span>        trend_interval <span class="op">=</span> <span class="op">(</span><span class="fl">1888</span><span class="op">:</span><span class="fl">1894</span><span class="op">)</span> <span class="op">-</span> <span class="fl">1887</span></span>
<span>      <span class="op">)</span></span>
<span>      <span class="va">bounty_slope</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">ibra_bounty_clone</span><span class="op">$</span><span class="va">all</span><span class="op">$</span><span class="va">abundance_trend</span></span>
<span>      <span class="va">ibra_bounty_clone</span> <span class="op">&lt;-</span> <span class="va">results</span><span class="op">$</span><span class="fu">new_clone</span><span class="op">(</span></span>
<span>        results <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>abundance <span class="op">=</span> <span class="va">ibra_bounty</span><span class="op">)</span>,</span>
<span>        trend_interval <span class="op">=</span> <span class="op">(</span><span class="fl">1895</span><span class="op">:</span><span class="fl">1901</span><span class="op">)</span> <span class="op">-</span> <span class="fl">1887</span></span>
<span>      <span class="op">)</span></span>
<span>      <span class="va">bounty_slope</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">ibra_bounty_clone</span><span class="op">$</span><span class="va">all</span><span class="op">$</span><span class="va">abundance_trend</span></span>
<span>      <span class="va">ibra_bounty_clone</span> <span class="op">&lt;-</span> <span class="va">results</span><span class="op">$</span><span class="fu">new_clone</span><span class="op">(</span></span>
<span>        results <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>abundance <span class="op">=</span> <span class="va">ibra_bounty</span><span class="op">)</span>,</span>
<span>        trend_interval <span class="op">=</span> <span class="op">(</span><span class="fl">1902</span><span class="op">:</span><span class="fl">1909</span><span class="op">)</span> <span class="op">-</span> <span class="fl">1887</span></span>
<span>      <span class="op">)</span></span>
<span>      <span class="va">bounty_slope</span><span class="op">[</span><span class="fl">3</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">ibra_bounty_clone</span><span class="op">$</span><span class="va">all</span><span class="op">$</span><span class="va">abundance_trend</span></span>
<span>      <span class="va">bounty_slope</span></span>
<span>    <span class="op">}</span>,</span>
<span>    ibra_extirpation <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">results</span><span class="op">)</span> <span class="op">{</span> <span class="co"># via results object cloning</span></span>
<span>      <span class="va">ibra_abundance_clone</span> <span class="op">&lt;-</span> <span class="va">results</span><span class="op">$</span><span class="fu">new_clone</span><span class="op">(</span>results <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>        abundance <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/t.html" class="external-link">t</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/array.html" class="external-link">array</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/unlist.html" class="external-link">unlist</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span></span>
<span>          <span class="va">results</span><span class="op">$</span><span class="fu">get_attribute</span><span class="op">(</span><span class="st">"ibra_indices"</span><span class="op">)</span>,</span>
<span>          <span class="kw">function</span><span class="op">(</span><span class="va">indices</span><span class="op">)</span> <span class="op">{</span></span>
<span>            <span class="fu"><a href="https://rdrr.io/r/base/colSums.html" class="external-link">colSums</a></span><span class="op">(</span><span class="va">results</span><span class="op">$</span><span class="va">abundance</span><span class="op">[</span><span class="va">indices</span>, <span class="op">]</span><span class="op">)</span></span>
<span>          <span class="op">}</span></span>
<span>        <span class="op">)</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">80</span>, <span class="fl">9</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span>      <span class="op">)</span><span class="op">)</span></span>
<span>      <span class="op">(</span><span class="fl">1888</span><span class="op">:</span><span class="fl">1967</span><span class="op">)</span><span class="op">[</span><span class="va">ibra_abundance_clone</span><span class="op">$</span><span class="va">extirpation</span><span class="op">]</span></span>
<span>    <span class="op">}</span></span>
<span>  <span class="op">)</span>,</span>
<span>  summary_metrics <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span></span>
<span>    <span class="st">"bounty_slope_error"</span>, <span class="st">"ibra_extirpation_error"</span>,</span>
<span>    <span class="st">"total_extinction"</span></span>
<span>  <span class="op">)</span>,</span>
<span>  summary_matrices <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span></span>
<span>    <span class="st">"extirpation"</span>, <span class="st">"total_bounty"</span>, <span class="st">"ibra_bounty"</span>,</span>
<span>    <span class="st">"bounty_slope"</span>, <span class="st">"ibra_extirpation"</span></span>
<span>  <span class="op">)</span>,</span>
<span>  summary_functions <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>    <span class="co"># Summary metrics</span></span>
<span>    bounty_slope_error <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">results</span><span class="op">)</span> <span class="op">{</span> <span class="co"># RMSE</span></span>
<span>      <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">sqrt</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="op">(</span><span class="va">results</span><span class="op">$</span><span class="fu">get_attribute</span><span class="op">(</span><span class="st">"targets"</span><span class="op">)</span><span class="op">$</span><span class="va">bounty_slope</span> <span class="op">-</span></span>
<span>        <span class="va">results</span><span class="op">$</span><span class="fu">get_attribute</span><span class="op">(</span><span class="st">"bounty_slope"</span><span class="op">)</span><span class="op">)</span><span class="op">^</span><span class="fl">2</span><span class="op">)</span><span class="op">)</span></span>
<span>    <span class="op">}</span>,</span>
<span>    ibra_extirpation_error <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">results</span><span class="op">)</span> <span class="op">{</span> <span class="co"># RMSE with NAs replaced</span></span>
<span>      <span class="va">ibra_extirpation</span> <span class="op">&lt;-</span> <span class="va">results</span><span class="op">$</span><span class="fu">get_attribute</span><span class="op">(</span><span class="st">"ibra_extirpation"</span><span class="op">)</span></span>
<span>      <span class="va">ibra_extirpation</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">ibra_extirpation</span><span class="op">)</span><span class="op">]</span> <span class="op">&lt;-</span></span>
<span>        <span class="va">results</span><span class="op">$</span><span class="fu">get_attribute</span><span class="op">(</span><span class="st">"extirp_NA_replace"</span><span class="op">)</span></span>
<span>      <span class="va">target_CI</span> <span class="op">&lt;-</span> <span class="va">results</span><span class="op">$</span><span class="fu">get_attribute</span><span class="op">(</span><span class="st">"targets"</span><span class="op">)</span><span class="op">$</span><span class="va">ibra_extirpation</span></span>
<span>      <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">sqrt</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span></span>
<span>        <span class="op">(</span><span class="op">(</span><span class="va">ibra_extirpation</span> <span class="op">&lt;</span> <span class="va">target_CI</span><span class="op">[</span><span class="fl">1</span>, <span class="op">]</span><span class="op">)</span> <span class="op">*</span> <span class="op">(</span><span class="va">ibra_extirpation</span> <span class="op">-</span> <span class="va">target_CI</span><span class="op">[</span><span class="fl">1</span>, <span class="op">]</span><span class="op">)</span> <span class="op">+</span></span>
<span>          <span class="op">(</span><span class="va">ibra_extirpation</span> <span class="op">&gt;</span> <span class="va">target_CI</span><span class="op">[</span><span class="fl">2</span>, <span class="op">]</span><span class="op">)</span> <span class="op">*</span> <span class="op">(</span><span class="va">ibra_extirpation</span> <span class="op">-</span> <span class="va">target_CI</span><span class="op">[</span><span class="fl">2</span>, <span class="op">]</span><span class="op">)</span><span class="op">)</span><span class="op">^</span><span class="fl">2</span>,</span>
<span>        na.rm <span class="op">=</span> <span class="cn">TRUE</span></span>
<span>      <span class="op">)</span><span class="op">)</span></span>
<span>    <span class="op">}</span>,</span>
<span>    total_extinction <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">results</span><span class="op">)</span> <span class="op">{</span></span>
<span>      <span class="op">(</span><span class="fl">1888</span><span class="op">:</span><span class="fl">1967</span><span class="op">)</span><span class="op">[</span><span class="va">results</span><span class="op">$</span><span class="va">all</span><span class="op">$</span><span class="va">extirpation</span><span class="op">]</span></span>
<span>    <span class="op">}</span>,</span>
<span>    <span class="co"># Summary matrices</span></span>
<span>    extirpation <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">results</span><span class="op">)</span> <span class="op">{</span> <span class="co"># for later use</span></span>
<span>      <span class="op">(</span><span class="fl">1888</span><span class="op">:</span><span class="fl">1967</span><span class="op">)</span><span class="op">[</span><span class="va">results</span><span class="op">$</span><span class="va">extirpation</span><span class="op">]</span></span>
<span>    <span class="op">}</span>,</span>
<span>    total_bounty <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">results</span><span class="op">)</span> <span class="op">{</span> <span class="co"># for later use</span></span>
<span>      <span class="fu"><a href="https://rdrr.io/r/base/colSums.html" class="external-link">colSums</a></span><span class="op">(</span><span class="va">results</span><span class="op">$</span><span class="fu">get_attribute</span><span class="op">(</span><span class="st">"bounty"</span><span class="op">)</span><span class="op">)</span></span>
<span>    <span class="op">}</span>,</span>
<span>    ibra_bounty <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">results</span><span class="op">)</span> <span class="op">{</span> <span class="co"># for later use</span></span>
<span>      <span class="fu"><a href="https://rdrr.io/r/base/colSums.html" class="external-link">rowSums</a></span><span class="op">(</span><span class="va">results</span><span class="op">$</span><span class="fu">get_attribute</span><span class="op">(</span><span class="st">"bounty"</span><span class="op">)</span><span class="op">)</span></span>
<span>    <span class="op">}</span>,</span>
<span>    bounty_slope <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">results</span><span class="op">)</span> <span class="op">{</span> <span class="co"># calculate RMSE later</span></span>
<span>      <span class="va">results</span><span class="op">$</span><span class="fu">get_attribute</span><span class="op">(</span><span class="st">"bounty_slope"</span><span class="op">)</span></span>
<span>    <span class="op">}</span>,</span>
<span>    ibra_extirpation <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">results</span><span class="op">)</span> <span class="op">{</span> <span class="co"># calculate RMSE later</span></span>
<span>      <span class="va">results</span><span class="op">$</span><span class="fu">get_attribute</span><span class="op">(</span><span class="st">"ibra_extirpation"</span><span class="op">)</span></span>
<span>    <span class="op">}</span></span>
<span>  <span class="op">)</span>,</span>
<span>  parallel_cores <span class="op">=</span> <span class="va">PARALLEL_CORES</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Generate the summary metrics and matrices</span></span>
<span><span class="va">gen_output</span> <span class="op">&lt;-</span> <span class="va">results_manager</span><span class="op">$</span><span class="fu">generate</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">gen_output</span><span class="op">$</span><span class="va">summary</span></span>
<span><span class="co">#&gt; [1] "2 of 2 summary metrics/matrices generated from sample results successfully"</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/list.files.html" class="external-link">dir</a></span><span class="op">(</span><span class="va">OUTPUT_DIR</span>, <span class="st">"*.txt"</span><span class="op">)</span> <span class="co"># plus generation log</span></span>
<span><span class="co">#&gt; [1] "generation_log.txt" "simulation_log.txt"</span></span>
<span><span class="va">summary_metric_data</span> <span class="op">&lt;-</span> <span class="va">results_manager</span><span class="op">$</span><span class="va">summary_metric_data</span></span>
<span><span class="va">summary_matrix_list</span> <span class="op">&lt;-</span> <span class="va">results_manager</span><span class="op">$</span><span class="va">summary_matrix_list</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">summary_metric_data</span><span class="op">)</span> <span class="co"># examine</span></span>
<span><span class="co">#&gt;   index bounty_slope_error ibra_extirpation_error total_extinction</span></span>
<span><span class="co">#&gt; 1     1           8.009511               18.54724             1957</span></span>
<span><span class="co">#&gt; 2     2           9.746232               29.43850               NA</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="va">summary_matrix_list</span>, <span class="va">dim</span><span class="op">)</span> <span class="co"># dimensions</span></span>
<span><span class="co">#&gt; $extirpation</span></span>
<span><span class="co">#&gt; [1]   2 795</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $total_bounty</span></span>
<span><span class="co">#&gt; [1]  2 80</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $ibra_bounty</span></span>
<span><span class="co">#&gt; [1] 2 9</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $bounty_slope</span></span>
<span><span class="co">#&gt; [1] 2 3</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $ibra_extirpation</span></span>
<span><span class="co">#&gt; [1] 2 9</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">summary_matrix_list</span><span class="op">$</span><span class="va">bounty_slope</span><span class="op">)</span> <span class="co"># examine</span></span>
<span><span class="co">#&gt;      [,1] [,2]      [,3]</span></span>
<span><span class="co">#&gt; [1,]  1.5 -7.5 -8.983333</span></span>
<span><span class="co">#&gt; [2,] -0.5 -3.0 -2.291667</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">summary_matrix_list</span><span class="op">$</span><span class="va">ibra_extirpation</span><span class="op">)</span> <span class="co"># examine</span></span>
<span><span class="co">#&gt;      [,1] [,2] [,3] [,4] [,5] [,6] [,7] [,8] [,9]</span></span>
<span><span class="co">#&gt; [1,] 1943 1951 1946 1947 1957 1954 1951 1955 1953</span></span>
<span><span class="co">#&gt; [2,] 1945 1952 1955 1954   NA   NA   NA   NA   NA</span></span></code></pre></div>
<p>Note that the summary matrix list collates the specified result for
each simulation on a single row of each matrix. Thus the columns in the
extirpation matrix represent the extirpation time for each population
cell, the columns in the total bounty and IBRA bounty matrices represent
the total bounty at each of the 80 simulation time steps, and for each
IBRA bioregion respectively. Similarly, the columns in the bounty slope
matrix represent regression slopes for each of the three time intervals,
and the IBRA extirpation matrix has a column for each of our nine
bioregions.</p>
</div>
<div class="section level5">
<h5 id="summary-metric-refinement">Summary metric refinement<a class="anchor" aria-label="anchor" href="#summary-metric-refinement"></a>
</h5>
<p>We can now collate and refine the summary metrics that we wish to
utilize in our validation and ensemble model selection (in step 6).
Although we have already calculated RMSE metrics for our bounty
regression slopes and IBRA extirpation dates, we could refine these by
utilizing their uncombined values in the corresponding matrices. Here we
will reproduce these metrics for our two samples for demonstration
purposes (in demonstration mode), before loading the full pre-generated
example metrics summary set. We will also calculate the error from the
target confidence interval (CI) for our simulated total extinction dates
for our full metrics set.</p>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Demonstrate calculating RMSE metrics from matrices</span></span>
<span><span class="kw">if</span> <span class="op">(</span><span class="va">DEMONSTRATION</span><span class="op">)</span> <span class="op">{</span> <span class="co"># Calculate RMSE for bounty slopes</span></span>
<span>  <span class="va">bounty_slope_error2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">sqrt</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/colSums.html" class="external-link">rowMeans</a></span><span class="op">(</span><span class="op">(</span><span class="va">summary_matrix_list</span><span class="op">$</span><span class="va">bounty_slope</span> <span class="op">-</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="va">targets</span><span class="op">$</span><span class="va">bounty_slope</span>,</span>
<span>      nrow <span class="op">=</span> <span class="fl">2</span>,</span>
<span>      ncol <span class="op">=</span> <span class="fl">3</span>, byrow <span class="op">=</span> <span class="cn">TRUE</span></span>
<span>    <span class="op">)</span><span class="op">)</span><span class="op">^</span><span class="fl">2</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span></span>
<span>    bounty_slope_error <span class="op">=</span> <span class="va">summary_metric_data</span><span class="op">$</span><span class="va">bounty_slope_error</span>,</span>
<span>    <span class="va">bounty_slope_error2</span></span>
<span>  <span class="op">)</span> <span class="co"># examine</span></span>
<span><span class="op">}</span></span>
<span><span class="co">#&gt;      bounty_slope_error bounty_slope_error2</span></span>
<span><span class="co">#&gt; [1,]           8.009511            8.009511</span></span>
<span><span class="co">#&gt; [2,]           9.746232            9.746232</span></span>
<span><span class="kw">if</span> <span class="op">(</span><span class="va">DEMONSTRATION</span><span class="op">)</span> <span class="op">{</span> <span class="co"># Calculate RMSE for IBRA extirpation</span></span>
<span>  <span class="va">ibra_extirpation</span> <span class="op">&lt;-</span> <span class="va">summary_matrix_list</span><span class="op">$</span><span class="va">ibra_extirpation</span></span>
<span>  <span class="va">ibra_extirpation</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">ibra_extirpation</span><span class="op">)</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">1968</span></span>
<span>  <span class="va">target_CI</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/array.html" class="external-link">array</a></span><span class="op">(</span><span class="va">targets</span><span class="op">$</span><span class="va">ibra_extirpation</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/dim.html" class="external-link">dim</a></span><span class="op">(</span><span class="va">targets</span><span class="op">$</span><span class="va">ibra_extirpation</span><span class="op">)</span>, <span class="fl">2</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="va">ibra_extirpation_error2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">sqrt</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/colSums.html" class="external-link">rowMeans</a></span><span class="op">(</span></span>
<span>    <span class="op">(</span><span class="op">(</span><span class="va">ibra_extirpation</span> <span class="op">&lt;</span> <span class="fu"><a href="https://rdrr.io/r/base/t.html" class="external-link">t</a></span><span class="op">(</span><span class="va">target_CI</span><span class="op">[</span><span class="fl">1</span>, , <span class="op">]</span><span class="op">)</span><span class="op">)</span> <span class="op">*</span> <span class="op">(</span><span class="va">ibra_extirpation</span> <span class="op">-</span> <span class="fu"><a href="https://rdrr.io/r/base/t.html" class="external-link">t</a></span><span class="op">(</span><span class="va">target_CI</span><span class="op">[</span><span class="fl">1</span>, , <span class="op">]</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>      <span class="op">(</span><span class="va">ibra_extirpation</span> <span class="op">&gt;</span> <span class="fu"><a href="https://rdrr.io/r/base/t.html" class="external-link">t</a></span><span class="op">(</span><span class="va">target_CI</span><span class="op">[</span><span class="fl">2</span>, , <span class="op">]</span><span class="op">)</span><span class="op">)</span> <span class="op">*</span> <span class="op">(</span><span class="va">ibra_extirpation</span> <span class="op">-</span> <span class="fu"><a href="https://rdrr.io/r/base/t.html" class="external-link">t</a></span><span class="op">(</span><span class="va">target_CI</span><span class="op">[</span><span class="fl">2</span>, , <span class="op">]</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">^</span><span class="fl">2</span>,</span>
<span>    na.rm <span class="op">=</span> <span class="cn">TRUE</span></span>
<span>  <span class="op">)</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span></span>
<span>    ibra_extirpation_error <span class="op">=</span> <span class="va">summary_metric_data</span><span class="op">$</span><span class="va">ibra_extirpation_error</span>,</span>
<span>    <span class="va">ibra_extirpation_error2</span></span>
<span>  <span class="op">)</span> <span class="co"># examine</span></span>
<span><span class="op">}</span></span>
<span><span class="co">#&gt;      ibra_extirpation_error ibra_extirpation_error2</span></span>
<span><span class="co">#&gt; [1,]               18.54724                18.54724</span></span>
<span><span class="co">#&gt; [2,]               29.43850                29.43850</span></span>
<span></span>
<span><span class="co"># Load full example metrics</span></span>
<span><span class="kw">if</span> <span class="op">(</span><span class="va">DEMONSTRATION</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">thylacine_example_metrics</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/dim.html" class="external-link">dim</a></span><span class="op">(</span><span class="va">thylacine_example_metrics</span><span class="op">)</span> <span class="co"># dimensions</span></span>
<span>  <span class="va">summary_metric_data</span> <span class="op">&lt;-</span> <span class="va">thylacine_example_metrics</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co"># Calculate the error from the CI of total extinction</span></span>
<span><span class="va">extinct</span> <span class="op">&lt;-</span> <span class="va">summary_metric_data</span><span class="op">$</span><span class="va">total_extinction</span></span>
<span><span class="va">target_CI</span> <span class="op">&lt;-</span> <span class="va">targets</span><span class="op">$</span><span class="va">total_extinction</span></span>
<span><span class="va">summary_metric_data</span><span class="op">$</span><span class="va">total_extinction_error</span> <span class="op">&lt;-</span></span>
<span>  <span class="op">(</span><span class="op">(</span><span class="va">extinct</span> <span class="op">&lt;</span> <span class="va">target_CI</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span> <span class="op">*</span> <span class="op">(</span><span class="va">extinct</span> <span class="op">-</span> <span class="va">target_CI</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="op">(</span><span class="va">extinct</span> <span class="op">&gt;</span> <span class="va">target_CI</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span><span class="op">)</span> <span class="op">*</span> <span class="op">(</span><span class="va">extinct</span> <span class="op">-</span> <span class="va">target_CI</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">summary_metric_data</span><span class="op">)</span> <span class="co"># examine</span></span>
<span><span class="co">#&gt;   index bounty_slope_error ibra_extirpation_error total_extinction</span></span>
<span><span class="co">#&gt; 1     1           11.66632              22.597013             1961</span></span>
<span><span class="co">#&gt; 2     2           10.00490              31.334885               NA</span></span>
<span><span class="co">#&gt; 3     3           17.04603               9.480243             1925</span></span>
<span><span class="co">#&gt; 4     4           10.35301              25.763346               NA</span></span>
<span><span class="co">#&gt; 5     5           20.13609              31.040296             1902</span></span>
<span><span class="co">#&gt; 6     6           21.62111              22.605309             1913</span></span>
<span><span class="co">#&gt;   total_extinction_error</span></span>
<span><span class="co">#&gt; 1                     19</span></span>
<span><span class="co">#&gt; 2                     NA</span></span>
<span><span class="co">#&gt; 3                    -11</span></span>
<span><span class="co">#&gt; 4                     NA</span></span>
<span><span class="co">#&gt; 5                    -34</span></span>
<span><span class="co">#&gt; 6                    -23</span></span></code></pre></div>
<p>Here we could have also replaced <em>NA</em> values, those indicating
that a population persisted, when calculating the error of the total
extinction date (from the target CI), however we will defer this so as
to demonstrate <em>NA</em> replacement functionality in the validator in
the next step.</p>
</div>
</div>
<div class="section level3">
<h3 id="step-6-build-a-validator-to-select-a-model-ensemble">Step 6: Build a validator to select a model ensemble<a class="anchor" aria-label="anchor" href="#step-6-build-a-validator-to-select-a-model-ensemble"></a>
</h3>
<p>We will now validate and select our model ensemble via the
<em>Validator</em> class, which by default utilizes an approximate
Bayesian computation (ABC) approach (Beaumont, Zhang, &amp; Balding,
2002) provided by the <em>abc</em> library (Csillery et al., 2015). We
will use the default configuration to select the best 200 models (via a
<em>tolerance</em> of 0.01). Our targets for selecting the best models
will be zero for our RMSE metrics for bounty slope, IBRA extirpation,
and total extinction. Note that for models where our simulated
<em>thylacine</em> persist until the end of the simulation (1967), the
total extinction value will be <em>NA</em>. Since the <em>abc</em>
function requires finite values only, we will use the
<em>non_finite_replacements</em> attribute of the validator to replace
these <em>NA</em> values with the RMSE (based on target CI)
corresponding to 1968. Stronger penalties could be applied if
desired.</p>
<p>Note that the validator generates diagnostics (as per the
<em>abc</em> documentation) as a PDF file in the configured output
directory. We can configure this directory, because locating the default
output directory generated via <em>tempdir()</em> can be tedious.</p>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Create a validator for selecting the 'best' example models</span></span>
<span><span class="va">validator</span> <span class="op">&lt;-</span> <span class="va"><a href="../reference/Validator.html">Validator</a></span><span class="op">$</span><span class="fu">new</span><span class="op">(</span></span>
<span>  simulation_parameters <span class="op">=</span> <span class="va">sample_data</span>,</span>
<span>  simulation_summary_metrics <span class="op">=</span> <span class="va">summary_metric_data</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span></span>
<span>    <span class="st">"bounty_slope_error"</span>,</span>
<span>    <span class="st">"ibra_extirpation_error"</span>,</span>
<span>    <span class="st">"total_extinction_error"</span></span>
<span>  <span class="op">)</span><span class="op">]</span>,</span>
<span>  observed_metric_targets <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span></span>
<span>    bounty_slope_error <span class="op">=</span> <span class="fl">0</span>,</span>
<span>    ibra_extirpation_error <span class="op">=</span> <span class="fl">0</span>,</span>
<span>    total_extinction_error <span class="op">=</span> <span class="fl">0</span></span>
<span>  <span class="op">)</span>,</span>
<span>  non_finite_replacements <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>total_extinction_error <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="op">(</span><span class="fl">1968</span> <span class="op">-</span> <span class="va">targets</span><span class="op">$</span><span class="va">total_extinction</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span><span class="op">)</span></span>
<span>  <span class="op">}</span><span class="op">)</span>,</span>
<span>  output_dir <span class="op">=</span> <span class="va">OUTPUT_DIR</span></span>
<span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/warning.html" class="external-link">suppressWarnings</a></span><span class="op">(</span><span class="va">validator</span><span class="op">$</span><span class="fu">run</span><span class="op">(</span></span>
<span>  tolerance <span class="op">=</span> <span class="fl">0.01</span>, sizenet <span class="op">=</span> <span class="fl">1</span>, lambda <span class="op">=</span> <span class="fl">0.0001</span>,</span>
<span>  output_diagnostics <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; 12345678910</span></span>
<span><span class="co">#&gt; 12345678910</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/list.files.html" class="external-link">dir</a></span><span class="op">(</span><span class="va">OUTPUT_DIR</span>, <span class="st">"*.pdf"</span><span class="op">)</span> <span class="co"># plus validation diagnostics (see abc library documentation)</span></span>
<span><span class="co">#&gt; [1] "validation_diagnostics.pdf"</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">validator</span><span class="op">$</span><span class="va">selected_simulations</span><span class="op">)</span> <span class="co"># examine</span></span>
<span><span class="co">#&gt;   index     weight</span></span>
<span><span class="co">#&gt; 1    93 0.02871514</span></span>
<span><span class="co">#&gt; 2    99 0.08332668</span></span>
<span><span class="co">#&gt; 3   164 0.21062364</span></span>
<span><span class="co">#&gt; 4   248 0.11186737</span></span>
<span><span class="co">#&gt; 5   309 0.43248925</span></span>
<span><span class="co">#&gt; 6   337 0.15984413</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/dim.html" class="external-link">dim</a></span><span class="op">(</span><span class="va">validator</span><span class="op">$</span><span class="va">selected_simulations</span><span class="op">)</span> <span class="co"># dimensions</span></span>
<span><span class="co">#&gt; [1] 200   2</span></span>
<span><span class="va">selected_indices</span> <span class="op">&lt;-</span> <span class="va">validator</span><span class="op">$</span><span class="va">selected_simulations</span><span class="op">$</span><span class="va">index</span></span>
<span><span class="va">selected_weights</span> <span class="op">&lt;-</span> <span class="va">validator</span><span class="op">$</span><span class="va">selected_simulations</span><span class="op">$</span><span class="va">weight</span></span></code></pre></div>
<p>Note that each selected model (via its index in the sample data
frame) have a corresponding weight value, which is indicative of the
congruence between each model’s summary metrics and the corresponding
target patterns.</p>
</div>
<div class="section level3">
<h3 id="selected-model-ensemble">Selected model ensemble<a class="anchor" aria-label="anchor" href="#selected-model-ensemble"></a>
</h3>
<p>Now that we have selected our model ensemble we can examine:</p>
<ul>
<li>how well our simulations did in hitting validation targets;</li>
<li>which model parameters were most influential in our ensemble
selection; and</li>
<li>the impact of model stochasticity on our ensemble selection.</li>
</ul>
<p>We can also verify our model via historic bounty record data not
explicitly utilized in our validation and model selection.</p>
<p>Lastly, we can use our model ensemble to examine the spatio-temporal
extirpation pattern of our simulated <em>thylacine</em> decline.</p>
<div class="section level5">
<h5 id="model-ensemble-summary-metrics">Model ensemble summary metrics<a class="anchor" aria-label="anchor" href="#model-ensemble-summary-metrics"></a>
</h5>
<p>To examine how well our individual (uncombined) metric targets have
been matched, let’s now plot the distributions of our summary metrics of
our selected model ensemble, as well as those of the full 20,000 model
simulations.</p>
<p>When in demonstration mode, we will load pre-generated example
matrices, provided with the <em>poems</em> package, containing bounty
slope and IBRA bioregion extirpations for all 20,000 sample simulations.
The example matrices also include cell extirpation dates, and a
time-series and IBRA distribution of total bounty, which we will use
later.</p>
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Load pre-generated example matrices</span></span>
<span><span class="kw">if</span> <span class="op">(</span><span class="va">DEMONSTRATION</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">thylacine_example_matrices</span><span class="op">)</span></span>
<span>  <span class="va">summary_matrix_list</span> <span class="op">&lt;-</span> <span class="va">thylacine_example_matrices</span></span>
<span><span class="op">}</span> <span class="kw">else</span> <span class="op">{</span> <span class="co"># cell extirpation and total/ibra bounty for selected samples only</span></span>
<span>  <span class="va">summary_matrix_list</span><span class="op">$</span><span class="va">extirpation</span> <span class="op">&lt;-</span> <span class="va">summary_matrix_list</span><span class="op">$</span><span class="va">extirpation</span><span class="op">[</span><span class="va">selected_indices</span>, <span class="op">]</span></span>
<span>  <span class="va">summary_matrix_list</span><span class="op">$</span><span class="va">total_bounty</span> <span class="op">&lt;-</span> <span class="va">summary_matrix_list</span><span class="op">$</span><span class="va">total_bounty</span><span class="op">[</span><span class="va">selected_indices</span>, <span class="op">]</span></span>
<span>  <span class="va">summary_matrix_list</span><span class="op">$</span><span class="va">ibra_bounty</span> <span class="op">&lt;-</span> <span class="va">summary_matrix_list</span><span class="op">$</span><span class="va">ibra_bounty</span><span class="op">[</span><span class="va">selected_indices</span>, <span class="op">]</span></span>
<span><span class="op">}</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="va">summary_matrix_list</span>, <span class="va">dim</span><span class="op">)</span> <span class="co"># dimensions</span></span>
<span><span class="co">#&gt; $extirpation</span></span>
<span><span class="co">#&gt; [1] 200 795</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $total_bounty</span></span>
<span><span class="co">#&gt; [1] 200  80</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $ibra_bounty</span></span>
<span><span class="co">#&gt; [1] 200   9</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $bounty_slope</span></span>
<span><span class="co">#&gt; [1] 20000     3</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $ibra_extirpation</span></span>
<span><span class="co">#&gt; [1] 20000     9</span></span>
<span></span>
<span><span class="co"># Plot the simulation, targets, and selected metrics for bounty slopes</span></span>
<span><span class="va">bounty_slope</span> <span class="op">&lt;-</span> <span class="va">summary_matrix_list</span><span class="op">$</span><span class="va">bounty_slope</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">bounty_slope</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="va">slope_intervals</span></span>
<span><span class="fu">graphics</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/graphics/boxplot.html" class="external-link">boxplot</a></span><span class="op">(</span><span class="va">bounty_slope</span>,</span>
<span>  border <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="st">"gray"</span>, <span class="fl">3</span><span class="op">)</span>, outline <span class="op">=</span> <span class="cn">FALSE</span>, range <span class="op">=</span> <span class="fl">0</span>,</span>
<span>  col <span class="op">=</span> <span class="cn">NULL</span>, ylim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">35</span>, <span class="fl">20</span><span class="op">)</span>, main <span class="op">=</span> <span class="st">"Thylacine bounty slope"</span>,</span>
<span>  xlab <span class="op">=</span> <span class="st">"Slope interval (years)"</span>, ylab <span class="op">=</span> <span class="st">"Bounty regression slope"</span></span>
<span><span class="op">)</span></span>
<span><span class="fu">graphics</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/graphics/boxplot.html" class="external-link">boxplot</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="va">bounty_slope</span><span class="op">[</span><span class="va">selected_indices</span>, <span class="op">]</span>, <span class="cn">NA</span><span class="op">)</span>, <span class="co"># NA for relative width</span></span>
<span>  border <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="st">"blue"</span>, <span class="fl">3</span><span class="op">)</span>, width <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">0.5</span>, <span class="fl">3</span><span class="op">)</span>, <span class="fl">1</span><span class="op">)</span>, outline <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  range <span class="op">=</span> <span class="fl">0</span>, add <span class="op">=</span> <span class="cn">TRUE</span>, col <span class="op">=</span> <span class="cn">NULL</span></span>
<span><span class="op">)</span></span>
<span><span class="fu">graphics</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/graphics/points.html" class="external-link">points</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">3</span>, y <span class="op">=</span> <span class="va">targets</span><span class="op">$</span><span class="va">bounty_slope</span>, col <span class="op">=</span> <span class="st">"red"</span>, pch <span class="op">=</span> <span class="fl">15</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/legend.html" class="external-link">legend</a></span><span class="op">(</span><span class="st">"topright"</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"All"</span>, <span class="st">"Target"</span>, <span class="st">"Selected"</span><span class="op">)</span>,</span>
<span>  fill <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"gray"</span>, <span class="st">"red"</span>, <span class="st">"blue"</span><span class="op">)</span>,</span>
<span>  border <span class="op">=</span> <span class="cn">NA</span>, cex <span class="op">=</span> <span class="fl">0.8</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p><img src="thylacine_example_files/figure-html/unnamed-chunk-23-1.png" width="672" style="display: block; margin: auto;"></p>
<p>From this plot we see that bounty slopes from all 20,000 sample
models do not all align well with our bounty slope targets, however,
bounty slopes from some models do reasonably well at matching targets.
These are the models that have been selected. Generally, the
distribution of our full sample set does not facilitate model congruence
with the targets, suggesting that our harvest function may be inadequate
for generating the expected temporal contour of the total
<em>thylacine</em> bounty. This inadequacy becomes clearer later, when
we plot the total bounty across time for our model ensemble.</p>
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Plot the simulation, targets, and selected metrics for extirpation</span></span>
<span><span class="va">extirpation</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span></span>
<span>  <span class="va">summary_matrix_list</span><span class="op">$</span><span class="va">ibra_extirpation</span>,</span>
<span>  <span class="va">summary_metric_data</span><span class="op">$</span><span class="va">total_extinction</span></span>
<span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">extirpation</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/character.html" class="external-link">as.character</a></span><span class="op">(</span><span class="va">tasmania_ibra_data</span><span class="op">$</span><span class="va">abbr</span><span class="op">)</span>, <span class="st">"Total"</span><span class="op">)</span></span>
<span><span class="fu">graphics</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/graphics/boxplot.html" class="external-link">boxplot</a></span><span class="op">(</span><span class="va">extirpation</span><span class="op">[</span>, <span class="fl">10</span><span class="op">:</span><span class="fl">1</span><span class="op">]</span>,</span>
<span>  border <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="st">"gray"</span>, <span class="fl">3</span><span class="op">)</span>, horizontal <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  outline <span class="op">=</span> <span class="cn">FALSE</span>, range <span class="op">=</span> <span class="fl">0</span>, col <span class="op">=</span> <span class="cn">NULL</span>, ylim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1888</span>, <span class="fl">1968</span><span class="op">)</span>,</span>
<span>  main <span class="op">=</span> <span class="st">"Thylacine model IBRA extirpation and total extinction"</span>,</span>
<span>  xlim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.5</span>, <span class="fl">11</span><span class="op">)</span>, xlab <span class="op">=</span> <span class="st">"Extirpation/extinction time (year)"</span>,</span>
<span>  ylab <span class="op">=</span> <span class="st">"IBRA bioregion/Tasmania-wide total"</span></span>
<span><span class="op">)</span></span>
<span><span class="fu">graphics</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/graphics/boxplot.html" class="external-link">boxplot</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="va">extirpation</span><span class="op">[</span><span class="va">selected_indices</span>, <span class="fl">10</span><span class="op">:</span><span class="fl">1</span><span class="op">]</span>, <span class="cn">NA</span><span class="op">)</span>,</span>
<span>  horizontal <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  ylim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1888</span>, <span class="fl">1968</span><span class="op">)</span>, border <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="st">"blue"</span>, <span class="fl">10</span><span class="op">)</span>,</span>
<span>  width <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">0.5</span>, <span class="fl">10</span><span class="op">)</span>, <span class="fl">1</span><span class="op">)</span>, outline <span class="op">=</span> <span class="cn">FALSE</span>, range <span class="op">=</span> <span class="fl">0</span>,</span>
<span>  add <span class="op">=</span> <span class="cn">TRUE</span>, col <span class="op">=</span> <span class="cn">NULL</span></span>
<span><span class="op">)</span></span>
<span><span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fl">9</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu">graphics</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/graphics/points.html" class="external-link">points</a></span><span class="op">(</span></span>
<span>    x <span class="op">=</span> <span class="va">targets</span><span class="op">$</span><span class="va">ibra_extirpation</span><span class="op">[</span>, <span class="va">i</span><span class="op">]</span>, y <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">11</span> <span class="op">-</span> <span class="va">i</span>, <span class="fl">2</span><span class="op">)</span>,</span>
<span>    col <span class="op">=</span> <span class="st">"red"</span>, pch <span class="op">=</span> <span class="fl">15</span></span>
<span>  <span class="op">)</span></span>
<span>  <span class="fu">graphics</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/graphics/lines.html" class="external-link">lines</a></span><span class="op">(</span></span>
<span>    x <span class="op">=</span> <span class="va">targets</span><span class="op">$</span><span class="va">ibra_extirpation</span><span class="op">[</span>, <span class="va">i</span><span class="op">]</span>, y <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">11</span> <span class="op">-</span> <span class="va">i</span>, <span class="fl">2</span><span class="op">)</span>,</span>
<span>    col <span class="op">=</span> <span class="st">"red"</span>, lwd <span class="op">=</span> <span class="fl">2</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">}</span></span>
<span><span class="fu">graphics</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/graphics/points.html" class="external-link">points</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">targets</span><span class="op">$</span><span class="va">total_extinction</span>, y <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">1</span><span class="op">)</span>, col <span class="op">=</span> <span class="st">"red"</span>, pch <span class="op">=</span> <span class="fl">15</span><span class="op">)</span></span>
<span><span class="fu">graphics</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/graphics/lines.html" class="external-link">lines</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">targets</span><span class="op">$</span><span class="va">total_extinction</span>, y <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">1</span><span class="op">)</span>, col <span class="op">=</span> <span class="st">"red"</span>, lwd <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/legend.html" class="external-link">legend</a></span><span class="op">(</span><span class="st">"topright"</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"All"</span>, <span class="st">"Target (CI)"</span>, <span class="st">"Selected"</span><span class="op">)</span>,</span>
<span>  fill <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"gray"</span>, <span class="st">"red"</span>, <span class="st">"blue"</span><span class="op">)</span>,</span>
<span>  border <span class="op">=</span> <span class="cn">NA</span>, cex <span class="op">=</span> <span class="fl">0.8</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p><img src="thylacine_example_files/figure-html/unnamed-chunk-24-1.png" width="672" style="display: block; margin: auto;"></p>
<p>Here we see that the simulated extirpation dates for individual IBRA
bioregions vary in their congruence with the target values, with some
strong matches, including our total Tasmania-wide extirpation date.
These results may contribute insight into the degree to which our
sampled model harvest parameters can influence the spatial dynamics of
the simulated <em>thylacine</em> decline.</p>
</div>
<div class="section level5">
<h5 id="model-ensemble-parameters">Model ensemble parameters<a class="anchor" aria-label="anchor" href="#model-ensemble-parameters"></a>
</h5>
<p>We can now examine the features of our selected model ensemble to
analyze its properties and adequacy. We can plot the distribution of our
200 selected model parameters in comparison to the (uniform)
distribution of the full 20,000 simulated models. Here we will examine
two notable example parameters: density Allee effect and harvest
catchability.</p>
<div class="sourceCode" id="cb27"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Allee effect</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/hist.html" class="external-link">hist</a></span><span class="op">(</span><span class="va">sample_data</span><span class="op">$</span><span class="va">density_allee</span>,</span>
<span>  breaks <span class="op">=</span> <span class="fl">30</span>, main <span class="op">=</span> <span class="st">"Model ensemble Allee effect"</span>,</span>
<span>  xlab <span class="op">=</span> <span class="st">"Allee effect"</span>, ylim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1000</span><span class="op">)</span>, col <span class="op">=</span> <span class="st">"gray"</span>, yaxt <span class="op">=</span> <span class="st">"n"</span></span>
<span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/hist.html" class="external-link">hist</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="va">sample_data</span><span class="op">$</span><span class="va">density_allee</span><span class="op">[</span><span class="va">selected_indices</span><span class="op">]</span>, <span class="fl">20</span><span class="op">)</span>, breaks <span class="op">=</span> <span class="fl">20</span>, col <span class="op">=</span> <span class="st">"blue"</span>, add <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/legend.html" class="external-link">legend</a></span><span class="op">(</span><span class="st">"topright"</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"All"</span>, <span class="st">"Selected"</span><span class="op">)</span>, fill <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"gray"</span>, <span class="st">"blue"</span><span class="op">)</span>, cex <span class="op">=</span> <span class="fl">0.8</span><span class="op">)</span></span></code></pre></div>
<p><img src="thylacine_example_files/figure-html/unnamed-chunk-25-1.png" width="672" style="display: block; margin: auto;"></p>
<div class="sourceCode" id="cb28"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="co"># Harvest catchability</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/hist.html" class="external-link">hist</a></span><span class="op">(</span><span class="va">sample_data</span><span class="op">$</span><span class="va">harvest_q</span>,</span>
<span>  breaks <span class="op">=</span> <span class="fl">30</span>, main <span class="op">=</span> <span class="st">"Model ensemble harvest catchability"</span>,</span>
<span>  xlab <span class="op">=</span> <span class="st">"Harvest catchability (q)"</span>, col <span class="op">=</span> <span class="st">"gray"</span></span>
<span><span class="op">)</span> <span class="co"># , yaxt = "n")</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/hist.html" class="external-link">hist</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="va">sample_data</span><span class="op">$</span><span class="va">harvest_q</span><span class="op">[</span><span class="va">selected_indices</span><span class="op">]</span>, <span class="fl">20</span><span class="op">)</span>, breaks <span class="op">=</span> <span class="fl">20</span>, col <span class="op">=</span> <span class="st">"blue"</span>, add <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/legend.html" class="external-link">legend</a></span><span class="op">(</span><span class="st">"topright"</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"All"</span>, <span class="st">"Selected"</span><span class="op">)</span>, fill <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"gray"</span>, <span class="st">"blue"</span><span class="op">)</span>, cex <span class="op">=</span> <span class="fl">0.8</span><span class="op">)</span></span></code></pre></div>
<p><img src="thylacine_example_files/figure-html/unnamed-chunk-25-2.png" width="672" style="display: block; margin: auto;"></p>
<p>From the first plot we could note the general reliance our model has
on the Allee effect in matching extirpation/extinction targets (or
non-persistence in general). The second plot illustrates how the
validation/selection process has “tuned” our harvest catchability
parameter.</p>
<p>We can also explore relationships between selected model parameters,
thus identifying which parameter combinations contributed to our
selected model ensemble’s congruence with our metric targets. Here we
examine one notable correlation between our selected model opportunistic
harvest rate and our catchability parameter.</p>
<div class="sourceCode" id="cb29"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span></span>
<span>  x <span class="op">=</span> <span class="va">sample_data</span><span class="op">$</span><span class="va">harvest_ohr</span>, y <span class="op">=</span> <span class="va">sample_data</span><span class="op">$</span><span class="va">harvest_q</span>, ylim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0.0055</span><span class="op">)</span>,</span>
<span>  xlab <span class="op">=</span> <span class="st">"Opportunistic harvest rate"</span>, ylab <span class="op">=</span> <span class="st">"Bio-economic harvest catchability"</span>,</span>
<span>  main <span class="op">=</span> <span class="st">"Opportunistic harvest vs. catchability"</span>, col <span class="op">=</span> <span class="st">"gray"</span></span>
<span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/points.html" class="external-link">points</a></span><span class="op">(</span></span>
<span>  x <span class="op">=</span> <span class="va">sample_data</span><span class="op">$</span><span class="va">harvest_ohr</span><span class="op">[</span><span class="va">selected_indices</span><span class="op">]</span>,</span>
<span>  y <span class="op">=</span> <span class="va">sample_data</span><span class="op">$</span><span class="va">harvest_q</span><span class="op">[</span><span class="va">selected_indices</span><span class="op">]</span>, col <span class="op">=</span> <span class="st">"blue"</span>, pch <span class="op">=</span> <span class="fl">3</span></span>
<span><span class="op">)</span></span>
<span><span class="fu">graphics</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/graphics/legend.html" class="external-link">legend</a></span><span class="op">(</span><span class="st">"topright"</span>,</span>
<span>  legend <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"All samples"</span>, <span class="st">"Selected"</span><span class="op">)</span>,</span>
<span>  col <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"gray"</span>, <span class="st">"blue"</span><span class="op">)</span>, pch <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">3</span><span class="op">)</span>, cex <span class="op">=</span> <span class="fl">0.8</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p><img src="thylacine_example_files/figure-html/unnamed-chunk-26-1.png" width="672" style="display: block; margin: auto;"></p>
<p>From the diagnostic output (PDF file in our output directory), we can
also examine the posterior distributions of our 200 selected model
parameters relative to their prior distributions. This can give us
further insight into the influence of each model parameter has had on
our model selection.</p>
<p>From these diagnostics and plots we can analyze and assess the
adequacy of our model and/or summary metrics. We may choose to refine
our model parameter ranges or our summary metrics. We can also choose to
simulate a more extensive parameter space, select fewer or more models
via our validator’s <em>tolerance</em> parameter, or revisit our model
structure. We may also wish to examine the role (demographic)
stochasticity has played in our model selection.</p>
</div>
<div class="section level5">
<h5 id="model-ensemble-stochasticity">Model ensemble stochasticity<a class="anchor" aria-label="anchor" href="#model-ensemble-stochasticity"></a>
</h5>
<p>We will now re-run each of our selected 200 models ten times, so as
to examine the impact of demographic stochasticity on our summary
metrics. Again, in demonstration mode, we will only run the first two
re-run simulations, then load example re-run summary metrics and
matrices provided by the <em>poems</em> package.</p>
<p>Note that in order to not override existing results files we can
either change our output directory, or alternatively, as we do here,
change the naming of the output files via the
<em>results_filename_attributes</em> attribute of the simulation and
results managers.</p>
<div class="sourceCode" id="cb30"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Run replicates of 10 for each selected model</span></span>
<span><span class="va">sample_data_rerun</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span>sample <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">sample_data</span><span class="op">)</span>, <span class="va">sample_data</span><span class="op">)</span></span>
<span><span class="va">sample_data_rerun</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="va">sample_data_rerun</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="va">selected_indices</span>, each <span class="op">=</span> <span class="fl">10</span><span class="op">)</span>, <span class="op">]</span>,</span>
<span>  rerun <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">10</span>, <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">selected_indices</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">sample_data_rerun</span><span class="op">)</span> <span class="co"># examine</span></span>
<span><span class="co">#&gt;      sample k_init k_decline k_phi growth_r density_allee harvest_ohr</span></span>
<span><span class="co">#&gt; 93       93   3153     0.042  0.73     0.29          43.2       0.072</span></span>
<span><span class="co">#&gt; 93.1     93   3153     0.042  0.73     0.29          43.2       0.072</span></span>
<span><span class="co">#&gt; 93.2     93   3153     0.042  0.73     0.29          43.2       0.072</span></span>
<span><span class="co">#&gt; 93.3     93   3153     0.042  0.73     0.29          43.2       0.072</span></span>
<span><span class="co">#&gt; 93.4     93   3153     0.042  0.73     0.29          43.2       0.072</span></span>
<span><span class="co">#&gt; 93.5     93   3153     0.042  0.73     0.29          43.2       0.072</span></span>
<span><span class="co">#&gt;      harvest_fb harvest_w harvest_E0 harvest_q harvest_v1 harvest_v2</span></span>
<span><span class="co">#&gt; 93         0.66       3.7         28    0.0014      0.016      0.414</span></span>
<span><span class="co">#&gt; 93.1       0.66       3.7         28    0.0014      0.016      0.414</span></span>
<span><span class="co">#&gt; 93.2       0.66       3.7         28    0.0014      0.016      0.414</span></span>
<span><span class="co">#&gt; 93.3       0.66       3.7         28    0.0014      0.016      0.414</span></span>
<span><span class="co">#&gt; 93.4       0.66       3.7         28    0.0014      0.016      0.414</span></span>
<span><span class="co">#&gt; 93.5       0.66       3.7         28    0.0014      0.016      0.414</span></span>
<span><span class="co">#&gt;      dispersal_p dispersal_b rerun</span></span>
<span><span class="co">#&gt; 93          0.39         8.4     1</span></span>
<span><span class="co">#&gt; 93.1        0.39         8.4     2</span></span>
<span><span class="co">#&gt; 93.2        0.39         8.4     3</span></span>
<span><span class="co">#&gt; 93.3        0.39         8.4     4</span></span>
<span><span class="co">#&gt; 93.4        0.39         8.4     5</span></span>
<span><span class="co">#&gt; 93.5        0.39         8.4     6</span></span>
<span><span class="kw">if</span> <span class="op">(</span><span class="va">DEMONSTRATION</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">sim_manager</span><span class="op">$</span><span class="va">sample_data</span> <span class="op">&lt;-</span> <span class="va">sample_data_rerun</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">2</span>, <span class="op">]</span></span>
<span><span class="op">}</span> <span class="kw">else</span> <span class="op">{</span></span>
<span>  <span class="va">sim_manager</span><span class="op">$</span><span class="va">sample_data</span> <span class="op">&lt;-</span> <span class="va">sample_data_rerun</span></span>
<span><span class="op">}</span></span>
<span><span class="va">sim_manager</span><span class="op">$</span><span class="va">results_filename_attributes</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"sample"</span>, <span class="st">"rerun"</span><span class="op">)</span></span>
<span><span class="va">run_output</span> <span class="op">&lt;-</span> <span class="va">sim_manager</span><span class="op">$</span><span class="fu">run</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">run_output</span><span class="op">$</span><span class="va">summary</span></span>
<span><span class="co">#&gt; [1] "2 of 2 sample models ran and saved results successfully"</span></span>
<span><span class="kw">if</span> <span class="op">(</span><span class="va">DEMONSTRATION</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/list.files.html" class="external-link">dir</a></span><span class="op">(</span><span class="va">OUTPUT_DIR</span>, <span class="st">"*.RData"</span><span class="op">)</span> <span class="co"># includes 2 new result files</span></span>
<span><span class="op">}</span></span>
<span><span class="co">#&gt; [1] "sample_1_results.RData"          "sample_2_results.RData"         </span></span>
<span><span class="co">#&gt; [3] "sample_93_rerun_1_results.RData" "sample_93_rerun_2_results.RData"</span></span>
<span></span>
<span><span class="co"># Collate summary metrics for re-runs</span></span>
<span><span class="kw">if</span> <span class="op">(</span><span class="va">DEMONSTRATION</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">results_manager</span><span class="op">$</span><span class="va">sample_data</span> <span class="op">&lt;-</span> <span class="va">sample_data_rerun</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">2</span>, <span class="op">]</span></span>
<span><span class="op">}</span> <span class="kw">else</span> <span class="op">{</span></span>
<span>  <span class="va">results_manager</span><span class="op">$</span><span class="va">sample_data</span> <span class="op">&lt;-</span> <span class="va">sample_data_rerun</span></span>
<span><span class="op">}</span></span>
<span><span class="va">results_manager</span><span class="op">$</span><span class="va">summary_matrices</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"bounty_slope"</span>, <span class="st">"ibra_extirpation"</span><span class="op">)</span></span>
<span><span class="va">results_manager</span><span class="op">$</span><span class="va">results_filename_attributes</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"sample"</span>, <span class="st">"rerun"</span><span class="op">)</span></span>
<span><span class="va">gen_output</span> <span class="op">&lt;-</span> <span class="va">results_manager</span><span class="op">$</span><span class="fu">generate</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">gen_output</span><span class="op">$</span><span class="va">summary</span></span>
<span><span class="co">#&gt; [1] "2 of 2 summary metrics/matrices generated from sample results successfully"</span></span>
<span><span class="kw">if</span> <span class="op">(</span><span class="va">DEMONSTRATION</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">results_manager</span><span class="op">$</span><span class="va">summary_metric_data</span> <span class="co"># examine demo</span></span>
<span><span class="op">}</span></span>
<span><span class="co">#&gt;   index bounty_slope_error ibra_extirpation_error total_extinction</span></span>
<span><span class="co">#&gt; 1     1           11.05617               5.431390             1931</span></span>
<span><span class="co">#&gt; 2     2           10.43017               4.898979             1931</span></span>
<span><span class="kw">if</span> <span class="op">(</span><span class="va">DEMONSTRATION</span><span class="op">)</span> <span class="op">{</span> <span class="co"># load full example metrics and (some) matrices</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">thylacine_example_metrics_rerun</span><span class="op">)</span></span>
<span>  <span class="va">summary_metric_data_rerun</span> <span class="op">&lt;-</span> <span class="va">thylacine_example_metrics_rerun</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">thylacine_example_matrices_rerun</span><span class="op">)</span></span>
<span>  <span class="va">summary_matrix_list_rerun</span> <span class="op">&lt;-</span> <span class="va">thylacine_example_matrices_rerun</span></span>
<span><span class="op">}</span> <span class="kw">else</span> <span class="op">{</span></span>
<span>  <span class="va">summary_metric_data_rerun</span> <span class="op">&lt;-</span> <span class="va">results_manager</span><span class="op">$</span><span class="va">summary_metric_data</span></span>
<span>  <span class="va">summary_matrix_list_rerun</span> <span class="op">&lt;-</span> <span class="va">results_manager</span><span class="op">$</span><span class="va">summary_matrix_list</span></span>
<span><span class="op">}</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">summary_metric_data_rerun</span><span class="op">)</span> <span class="co"># examine</span></span>
<span><span class="co">#&gt;   index bounty_slope_error ibra_extirpation_error total_extinction</span></span>
<span><span class="co">#&gt; 1     1           10.51599               7.516648             1929</span></span>
<span><span class="co">#&gt; 2     2           11.47151               4.227884             1934</span></span>
<span><span class="co">#&gt; 3     3           11.57192               4.358899             1934</span></span>
<span><span class="co">#&gt; 4     4           11.42602               5.809475             1938</span></span>
<span><span class="co">#&gt; 5     5           11.36964               6.304760             1930</span></span>
<span><span class="co">#&gt; 6     6           12.07262               5.937171             1933</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/dim.html" class="external-link">dim</a></span><span class="op">(</span><span class="va">summary_metric_data_rerun</span><span class="op">)</span> <span class="co"># dimensions</span></span>
<span><span class="co">#&gt; [1] 2000    4</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="va">summary_matrix_list_rerun</span>, <span class="va">dim</span><span class="op">)</span> <span class="co"># dimensions</span></span>
<span><span class="co">#&gt; $bounty_slope</span></span>
<span><span class="co">#&gt; [1] 2000    3</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $ibra_extirpation</span></span>
<span><span class="co">#&gt; [1] 2000    9</span></span></code></pre></div>
<p>Note that the output directory contains new R-data result files for
each sample rerun simulation, named via a unique combination of sample
data frame attributes.</p>
<p>Now we can compare the distributions of our metrics for all,
selected, and re-run models to better assess the impact of
stochasticity. Note that simulations that persist are represented via an
extirpation date of 1968.</p>
<div class="sourceCode" id="cb31"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Bounty slope error</span></span>
<span><span class="va">bounty_slope_error</span> <span class="op">&lt;-</span> <span class="va">summary_metric_data</span><span class="op">$</span><span class="va">bounty_slope_error</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/hist.html" class="external-link">hist</a></span><span class="op">(</span><span class="va">bounty_slope_error</span>,</span>
<span>  breaks <span class="op">=</span> <span class="fl">140</span>, main <span class="op">=</span> <span class="st">"Thylacine bounty slope error"</span>,</span>
<span>  xlim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">50</span><span class="op">)</span>, xlab <span class="op">=</span> <span class="st">"Bounty slope RMSE"</span>, col <span class="op">=</span> <span class="st">"gray"</span>, yaxt <span class="op">=</span> <span class="st">"n"</span></span>
<span><span class="op">)</span></span>
<span><span class="va">bounty_slope_error_r</span> <span class="op">&lt;-</span> <span class="va">summary_metric_data_rerun</span><span class="op">$</span><span class="va">bounty_slope_error</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/hist.html" class="external-link">hist</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="va">bounty_slope_error_r</span>, <span class="fl">2</span><span class="op">)</span>, breaks <span class="op">=</span> <span class="fl">20</span>, col <span class="op">=</span> <span class="st">"gold3"</span>, add <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/hist.html" class="external-link">hist</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="va">bounty_slope_error</span><span class="op">[</span><span class="va">selected_indices</span><span class="op">]</span>, <span class="fl">5</span><span class="op">)</span>,</span>
<span>  breaks <span class="op">=</span> <span class="fl">12</span>,</span>
<span>  col <span class="op">=</span> <span class="st">"blue"</span>, add <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/lines.html" class="external-link">lines</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">2</span><span class="op">)</span>, y <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">10000</span><span class="op">)</span>, col <span class="op">=</span> <span class="st">"red"</span>, lwd <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/legend.html" class="external-link">legend</a></span><span class="op">(</span><span class="st">"topright"</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"All"</span>, <span class="st">"Target"</span>, <span class="st">"Selected"</span>, <span class="st">"Replicates"</span><span class="op">)</span>,</span>
<span>  fill <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"gray"</span>, <span class="st">"red"</span>, <span class="st">"blue"</span>, <span class="st">"gold3"</span><span class="op">)</span>, cex <span class="op">=</span> <span class="fl">0.8</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p><img src="thylacine_example_files/figure-html/unnamed-chunk-28-1.png" width="672" style="display: block; margin: auto;"></p>
<div class="sourceCode" id="cb32"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="co"># IBRA extirpation error</span></span>
<span><span class="va">ibra_extirpation_error</span> <span class="op">&lt;-</span> <span class="va">summary_metric_data</span><span class="op">$</span><span class="va">ibra_extirpation_error</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/hist.html" class="external-link">hist</a></span><span class="op">(</span><span class="va">bounty_slope_error</span>,</span>
<span>  breaks <span class="op">=</span> <span class="fl">140</span>, main <span class="op">=</span> <span class="st">"Thylacine IBRA extirpation error"</span>,</span>
<span>  xlim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">50</span><span class="op">)</span>, xlab <span class="op">=</span> <span class="st">"IBRA extirpation RMSE"</span>, col <span class="op">=</span> <span class="st">"grey"</span>, yaxt <span class="op">=</span> <span class="st">"n"</span></span>
<span><span class="op">)</span></span>
<span><span class="va">ibra_extirpation_error_r</span> <span class="op">&lt;-</span> <span class="va">summary_metric_data_rerun</span><span class="op">$</span><span class="va">ibra_extirpation_error</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/hist.html" class="external-link">hist</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="va">ibra_extirpation_error_r</span>, <span class="fl">2</span><span class="op">)</span>, breaks <span class="op">=</span> <span class="fl">50</span>, col <span class="op">=</span> <span class="st">"gold3"</span>, add <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/hist.html" class="external-link">hist</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="va">ibra_extirpation_error</span><span class="op">[</span><span class="va">selected_indices</span><span class="op">]</span>, <span class="fl">5</span><span class="op">)</span>,</span>
<span>  breaks <span class="op">=</span> <span class="fl">20</span>, col <span class="op">=</span> <span class="st">"blue"</span>,</span>
<span>  add <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/lines.html" class="external-link">lines</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">2</span><span class="op">)</span>, y <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">10000</span><span class="op">)</span>, col <span class="op">=</span> <span class="st">"red"</span>, lwd <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/legend.html" class="external-link">legend</a></span><span class="op">(</span><span class="st">"topright"</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"All"</span>, <span class="st">"Target"</span>, <span class="st">"Selected"</span>, <span class="st">"Replicates"</span><span class="op">)</span>,</span>
<span>  fill <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"grey"</span>, <span class="st">"red"</span>, <span class="st">"blue"</span>, <span class="st">"gold3"</span><span class="op">)</span>, cex <span class="op">=</span> <span class="fl">0.8</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p><img src="thylacine_example_files/figure-html/unnamed-chunk-28-2.png" width="672" style="display: block; margin: auto;"></p>
<div class="sourceCode" id="cb33"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="co"># Extinction time</span></span>
<span><span class="va">extinction_time</span> <span class="op">&lt;-</span> <span class="va">summary_metric_data</span><span class="op">$</span><span class="va">total_extinction</span></span>
<span><span class="va">persistent_number</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/which.html" class="external-link">which</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">extinction_time</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">extinction_time_finite</span> <span class="op">&lt;-</span> <span class="va">extinction_time</span><span class="op">[</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">extinction_time</span><span class="op">)</span><span class="op">]</span></span>
<span><span class="va">extinction_time_modified</span> <span class="op">&lt;-</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/graphics/hist.html" class="external-link">hist</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">extinction_time_finite</span>, <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">1968</span>, <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="va">persistent_number</span> <span class="op">/</span> <span class="fl">10</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>,</span>
<span>    breaks <span class="op">=</span> <span class="fl">81</span>,</span>
<span>    main <span class="op">=</span> <span class="st">"Thylacine extinction"</span>, xlim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1888</span>, <span class="fl">1968</span><span class="op">)</span>,</span>
<span>    xlab <span class="op">=</span> <span class="st">"Extinction time (year)"</span>, col <span class="op">=</span> <span class="st">"gray40"</span>, yaxt <span class="op">=</span> <span class="st">"n"</span></span>
<span>  <span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/hist.html" class="external-link">hist</a></span><span class="op">(</span><span class="va">extinction_time_finite</span>, breaks <span class="op">=</span> <span class="fl">81</span>, col <span class="op">=</span> <span class="st">"gray"</span>, add <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="va">extinction_time_rerun</span> <span class="op">&lt;-</span> <span class="va">summary_metric_data_rerun</span><span class="op">$</span><span class="va">total_extinction</span></span>
<span><span class="va">extinction_time_rerun</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/which.html" class="external-link">which</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">extinction_time_rerun</span><span class="op">)</span><span class="op">)</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">1968</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/hist.html" class="external-link">hist</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="va">extinction_time_rerun</span>, <span class="fl">2</span><span class="op">)</span>, breaks <span class="op">=</span> <span class="fl">50</span>, col <span class="op">=</span> <span class="st">"gold3"</span>, add <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/hist.html" class="external-link">hist</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="va">extinction_time</span><span class="op">[</span><span class="va">selected_indices</span><span class="op">]</span>, <span class="fl">5</span><span class="op">)</span>, breaks <span class="op">=</span> <span class="fl">28</span>, col <span class="op">=</span> <span class="st">"blue"</span>, add <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/lines.html" class="external-link">lines</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">1931</span>, <span class="fl">2</span><span class="op">)</span>, y <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">10000</span><span class="op">)</span>, col <span class="op">=</span> <span class="st">"red"</span>, lwd <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/lines.html" class="external-link">lines</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">1937</span>, <span class="fl">2</span><span class="op">)</span>, y <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">10000</span><span class="op">)</span>, col <span class="op">=</span> <span class="st">"red"</span>, lwd <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/legend.html" class="external-link">legend</a></span><span class="op">(</span><span class="st">"topleft"</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"All"</span>, <span class="st">"(persistent/10)"</span>, <span class="st">"Target (CI)"</span>, <span class="st">"Selected"</span>, <span class="st">"Replicates"</span><span class="op">)</span>,</span>
<span>  fill <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"gray"</span>, <span class="st">"gray40"</span>, <span class="st">"red"</span>, <span class="st">"blue"</span>, <span class="st">"gold3"</span><span class="op">)</span>, cex <span class="op">=</span> <span class="fl">0.8</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p><img src="thylacine_example_files/figure-html/unnamed-chunk-28-3.png" width="672" style="display: block; margin: auto;"></p>
<p>From these plots we can observe that stochastic processes operating
in our model have some impact on our model validation and ensemble
selection, since the distributions of the metrics have slightly widened
in our model ensemble replicate re-runs. However, they have retained
their proximity to the targets well. We could further analyze the
effects of stochasticity by exploring approaches for identifying which
of our selected models are congruent with our target metrics most
frequently.</p>
</div>
<div class="section level5">
<h5 id="model-ensemble-verification">Model ensemble verification<a class="anchor" aria-label="anchor" href="#model-ensemble-verification"></a>
</h5>
<p>We can verify the adequacy of our model by examining how well it
produces observed data patterns that were not (explicitly) utilized in
the model calibration, validation and selection stages. While the slopes
of the bounty were used for validating and selecting our model ensemble,
the actual bounty magnitudes were not. Let’s now use our model ensemble
to compare our simulated total bounty and the total historical
(time-series) records across time (provided with the <em>poems</em>
package). Here we will use the selected model weights to calculate a
weighted average of simulated bounty submitted for the selected ensemble
and their replicates.</p>
<div class="sourceCode" id="cb34"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Compare weighted ensemble model to actual historical bounty time-series</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">thylacine_bounty_record</span><span class="op">)</span></span>
<span><span class="va">selected_bounty</span> <span class="op">&lt;-</span> <span class="va">summary_matrix_list</span><span class="op">$</span><span class="va">total_bounty</span></span>
<span><span class="va">weighted_bounty</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/colSums.html" class="external-link">colSums</a></span><span class="op">(</span><span class="va">selected_bounty</span> <span class="op">*</span> <span class="va">selected_weights</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">selected_weights</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Plot the simulated and actual bounty</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span></span>
<span>  x <span class="op">=</span> <span class="fl">1888</span><span class="op">:</span><span class="fl">1909</span>, y <span class="op">=</span> <span class="va">weighted_bounty</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">22</span><span class="op">]</span>, xlab <span class="op">=</span> <span class="st">"Year"</span>,</span>
<span>  ylab <span class="op">=</span> <span class="st">"Number of thylacines"</span>, main <span class="op">=</span> <span class="st">"Thylacine bounty submitted"</span>,</span>
<span>  ylim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">200</span><span class="op">)</span>, type <span class="op">=</span> <span class="st">"l"</span>, col <span class="op">=</span> <span class="st">"blue"</span>, lwd <span class="op">=</span> <span class="fl">2</span></span>
<span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/lines.html" class="external-link">lines</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fl">1888</span><span class="op">:</span><span class="fl">1909</span>, y <span class="op">=</span> <span class="va">thylacine_bounty_record</span><span class="op">$</span><span class="va">Total</span>, lty <span class="op">=</span> <span class="fl">1</span>, col <span class="op">=</span> <span class="st">"red"</span>, lwd <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/legend.html" class="external-link">legend</a></span><span class="op">(</span><span class="st">"topright"</span>,</span>
<span>  legend <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Model ensemble bounty"</span>, <span class="st">"Actual bounty"</span><span class="op">)</span>,</span>
<span>  col <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"blue"</span>, <span class="st">"red"</span><span class="op">)</span>, lty <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">1</span><span class="op">)</span>, lwd <span class="op">=</span> <span class="fl">2</span>, cex <span class="op">=</span> <span class="fl">0.8</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p><img src="thylacine_example_files/figure-html/unnamed-chunk-29-1.png" width="672" style="display: block; margin: auto;"></p>
<p>We can also compare our simulated total bounty submitted, both across
IBRA bioregions and Tasmania-wide, to our historical bounty record.</p>
<div class="sourceCode" id="cb35"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Compare weighted ensemble model to actual historical bioregion bounty values</span></span>
<span><span class="va">selected_bounty</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span></span>
<span>  <span class="va">summary_matrix_list</span><span class="op">$</span><span class="va">ibra_bounty</span>,</span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/colSums.html" class="external-link">rowSums</a></span><span class="op">(</span><span class="va">summary_matrix_list</span><span class="op">$</span><span class="va">ibra_bounty</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="va">weighted_bounty</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/colSums.html" class="external-link">colSums</a></span><span class="op">(</span><span class="va">selected_bounty</span> <span class="op">*</span> <span class="va">selected_weights</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">selected_weights</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">combined_bounty</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">rbind</a></span><span class="op">(</span></span>
<span>  <span class="va">weighted_bounty</span>,</span>
<span>  <span class="va">actual_bounty</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/colSums.html" class="external-link">colSums</a></span><span class="op">(</span><span class="va">thylacine_bounty_record</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">3</span><span class="op">:</span><span class="fl">11</span>, <span class="fl">2</span><span class="op">)</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="va">combined_bounty</span><span class="op">[</span>, <span class="fl">10</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">combined_bounty</span><span class="op">[</span>, <span class="fl">10</span><span class="op">]</span> <span class="op">/</span> <span class="fl">2</span></span>
<span></span>
<span><span class="co"># Comparative plot of simulated and historic IBRA/total bounty</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/barplot.html" class="external-link">barplot</a></span><span class="op">(</span><span class="va">combined_bounty</span>,</span>
<span>  xlab <span class="op">=</span> <span class="st">"IBRA bioregion/Tasmania-wide total"</span>, beside <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  ylab <span class="op">=</span> <span class="st">"Number of thylacines"</span>, col <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"blue"</span>, <span class="st">"red"</span><span class="op">)</span>,</span>
<span>  main <span class="op">=</span> <span class="st">"Thylacine bounty submitted by region"</span>, border <span class="op">=</span> <span class="cn">NA</span></span>
<span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/legend.html" class="external-link">legend</a></span><span class="op">(</span><span class="st">"topleft"</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Model ensemble bounty"</span>, <span class="st">"Actual bounty"</span>, <span class="st">"Note: Total/2"</span><span class="op">)</span>,</span>
<span>  fill <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"blue"</span>, <span class="st">"red"</span>, <span class="cn">NA</span><span class="op">)</span>, border <span class="op">=</span> <span class="cn">NA</span>, cex <span class="op">=</span> <span class="fl">0.8</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p><img src="thylacine_example_files/figure-html/unnamed-chunk-30-1.png" width="672" style="display: block; margin: auto;"></p>
<p>We could do more thorough statistical analyzes to verify our model
ensemble. However, from our comparative plots of <em>thylacine</em>
bounty harvests we have gained insight into how well our ensemble model
matches the bounty record both temporally and spatially. We could thus
devise ways in which to improve future versions of our model, including
developing a harvest function with mechanisms and parameterization that
better model spatio-temporal responses to the bounty reward. With these
advances we could possibly gain better insights into spatio-temporal
dynamics of the <em>thylacine</em> decline.</p>
</div>
<div class="section level5">
<h5 id="model-ensemble-usage">Model ensemble usage<a class="anchor" aria-label="anchor" href="#model-ensemble-usage"></a>
</h5>
<p>As a final demonstration let’s see how we can use our ensemble to
examine our simulated spatio-temporal extirpation pattern.</p>
<div class="sourceCode" id="cb36"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Calculate the weighted cell extirpation dates</span></span>
<span><span class="va">selected_extirp</span> <span class="op">&lt;-</span> <span class="va">summary_matrix_list</span><span class="op">$</span><span class="va">extirpation</span></span>
<span><span class="va">weighted_extirpation</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/colSums.html" class="external-link">colSums</a></span><span class="op">(</span><span class="va">selected_extirp</span> <span class="op">*</span> <span class="va">selected_weights</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">selected_weights</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Plot the weighted cell extirpation dates</span></span>
<span><span class="va">extirpation_raster</span> <span class="op">&lt;-</span> <span class="va">region</span><span class="op">$</span><span class="fu">raster_from_values</span><span class="op">(</span><span class="va">weighted_extirpation</span><span class="op">)</span></span>
<span><span class="fu">raster</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/base/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">extirpation_raster</span>,</span>
<span>  main <span class="op">=</span> <span class="st">"Thylacine model ensemble extirpation"</span>,</span>
<span>  xlab <span class="op">=</span> <span class="st">"Longitude (degrees)"</span>, ylab <span class="op">=</span> <span class="st">"Latitude (degrees)"</span>,</span>
<span>  zlim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1888</span>, <span class="fl">1940</span><span class="op">)</span>, col <span class="op">=</span> <span class="fu">grDevices</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/grDevices/palettes.html" class="external-link">heat.colors</a></span><span class="op">(</span><span class="fl">100</span><span class="op">)</span>, colNA <span class="op">=</span> <span class="st">"blue"</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p><img src="thylacine_example_files/figure-html/unnamed-chunk-31-1.png" width="480" style="display: block; margin: auto;"></p>
</div>
</div>
</div>
<div class="section level2">
<h2 id="summary">Summary<a class="anchor" aria-label="anchor" href="#summary"></a>
</h2>
<p>Building and utilizing our model ensemble for the <em>thylacine</em>
has provided a relatively advanced demonstration of the <em>poems</em>
6-step workflow and its modules.</p>
<ol style="list-style-type: decimal">
<li>First we constructed a customized model with user-defined density
dependence and harvest functions.</li>
<li>We then used functionality for dynamically generating stage
matrices, initial abundances, carrying capacities, and dispersal
rates.</li>
<li>We generated sample model parameters via Latin hypercube
sampling.</li>
<li>We ran these sampled models via a <em>poems</em> simulation
manager.</li>
<li>We then collated and calculated summary metrics, based on functions
we defined within a results manager.</li>
<li>After which, we fed our sample model parameters, our summary
metrics, and target values for those metrics (derived from historical
bounty and sighting records), into an ABC validator, and ran it to
select our model ensemble.</li>
</ol>
<p>We then examined how well our model ensemble matched our target
metrics, and analyzed the influence that our model parameters and
stochasticity had on the ensemble selection. We also verified our model
via the bounty records to see how well it matched patterns that was not
explicitly used in the model calibration, validation and ensemble
selection.</p>
<p>Applying the <em>poems</em> workflow to the <em>thylacine</em>
resulted in the selection of models that best reconstructed the range
and extinction dynamics of the species, given the validation targets
that were accessible and the model structure. Simulations of bounty
harvest matched the historical records well, particularly at the
Tasmania-wide level. Simulated extirpation pattern and time of
extinction matched known estimates for the <em>thylacine</em> with
fair-to-good accuracy. Further model developments could include changes
to the way that harvesters respond to the bounty reward, so as to better
match how the historical bounty changed over time and space.</p>
<p>In running the steps in this vignette’s workflow, we have explored
much of the functionality offered by <em>poems</em>. The aim of the
feature-rich example was to provide a guide for building your own
customized models with <em>poems</em>, so that you can explore the
spatio-temporal population dynamics of species of interest in your
research and practice.</p>
<p>Thank you :-)</p>
</div>
<div class="section level2">
<h2 id="references">References<a class="anchor" aria-label="anchor" href="#references"></a>
</h2>
<p>Allee, W. C. (1931). <em>Animal Aggregations: A Study in General
Sociology</em>. University of Chicago Press.</p>
<p>Beaumont, M. A., Zhang, W., &amp; Balding, D. J. (2002). ‘Approximate
Bayesian computation in population genetics’. <em>Genetics</em>,
vol. 162, no. 4, pp, 2025–2035.</p>
<p>Bulte, E. H., Horan, R. D., &amp; Shogren, J. F. (2003). ‘Is the
Tasmanian tiger extinct? A biological–economic re-evaluation’,
<em>Ecological Economics</em>, vol. 45, no. 2, pp. 271–279.</p>
<p>Csillery, K., Lemaire L., Francois O., &amp; Blum M. (2015). ‘abc:
Tools for Approximate Bayesian Computation (ABC)’. <em>R package version
2.1</em>. Retrieved from <a href="https://CRAN.R-project.org/package=abc" class="external-link uri">https://CRAN.R-project.org/package=abc</a></p>
<p>Grimm, V., Revilla, E., Berger, U., Jeltsch, F., Mooij, W. M.,
Railsback, S. F., Thulke, H. H., Weiner, J., Wiegand, T., DeAngelis, D.
L., (2005). ‘Pattern-Oriented Modeling of Agent-Based Complex Systems:
Lessons from Ecology’. <em>Science</em> vol. 310, no. 5750,
pp. 987–991.</p>
<p>Guiler, E. (1985). <em>Thylacine: The Tragedy of the Tasmanian
Tiger</em>. Oxford University Press, Melbourne.</p>
<p>Guiler E. R. &amp; Godard P. (1998). <em>Tasmanian tiger: a lesson to
be learnt</em>. Abrolhos Publishing, Perth, Western Australia.</p>
<p>Ricker, W. E. (1954). ‘Stock and recruitment’. <em>Journal of the
Fisheries Research Board of Canada</em>, vol. 11, no. 5,
pp. 559-623.</p>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by Sean Haythorne, Damien Fordham, Stuart Brown, Jessie Buettel, Barry Brook, <a href="https://pilowsky.me" class="external-link">July Pilowsky</a>.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
