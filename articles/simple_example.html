<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="poems">
<title>Simple workflow example for a population model • poems</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Simple workflow example for a population model">
<meta property="og:description" content="poems">
<meta property="og:image" content="https://globalecologylab.github.io/poems/logo.svg">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">poems</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.1.1</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/simple_example.html">Simple workflow example for a population model</a>
    <a class="dropdown-item" href="../articles/thylacine_example.html">Workflow example for the Tasmanian thylacine</a>
    <a class="dropdown-item" href="../articles/translocation_example.html">Population introduction via translocation functions</a>
  </div>
</li>
<li class="nav-item">
  <a class="nav-link" href="../news/index.html">Changelog</a>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/GlobalEcologyLab/poems/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.svg" class="logo" alt=""><h1>Simple workflow example for a population model</h1>
                        <h4 data-toc-skip class="author">Global ChEC
Lab</h4>
            
            <h4 data-toc-skip class="date">2024-04-03</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/GlobalEcologyLab/poems/blob/HEAD/vignettes/simple_example.Rmd" class="external-link"><code>vignettes/simple_example.Rmd</code></a></small>
      <div class="d-none name"><code>simple_example.Rmd</code></div>
    </div>

    
    
<p>In this vignette we present a simple example of the <em>poems</em>
workflow using a fictitious population model. The purpose of this
example is to demonstrate how the components of the package are used to
build an ensemble of viable models that best match known or desired
patterns. Although the package is designed to facilitate building
complex models and running multitudes of sample simulations, the scale
and complexity of this demonstration model is deliberately minimal so as
to easily examine the outputs at every stage of the workflow.</p>
<div class="section level2">
<h2 id="setup">Setup<a class="anchor" aria-label="anchor" href="#setup"></a>
</h2>
<p>We begin by loading the <em>poems</em> package and setting our output
directory.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/GlobalEcologyLab/poems" class="external-link">poems</a></span><span class="op">)</span></span>
<span><span class="va">OUTPUT_DIR</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/tempfile.html" class="external-link">tempdir</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="workflow">Workflow<a class="anchor" aria-label="anchor" href="#workflow"></a>
</h2>
<p>The <em>poems</em> workflow, which implements a pattern-oriented
modeling (POM) approach (Grimm et al., 2005), is achieved via a
framework of interoperable components:</p>
<p>The workflow is summarized by the following six steps:</p>
<ol style="list-style-type: decimal">
<li>Build the population model for the study region.</li>
<li>Build generators for dynamically generating model parameters.</li>
<li>Sample model and generator parameters for each simulation.</li>
<li>Build a simulation manager to run each simulation.</li>
<li>Build a results manager to generate summary results (metrics).</li>
<li>Build a validator to select a model ensemble.</li>
</ol>
<div class="section level3">
<h3 id="step-1-build-the-population-model-for-the-study-region">Step 1: Build the population model for the study region<a class="anchor" aria-label="anchor" href="#step-1-build-the-population-model-for-the-study-region"></a>
</h3>
<p>Create a model template using the <em>PopulationModel</em> class. If
the model is spatially explicit, then define the study region via the
<em>Region</em> class. All fixed model inputs, such as environmental
correlations, as well as any user-defined functions for processes such
as harvesting, should be set at this stage.</p>
<p>We could create these components in any order and set model
parameters separately, but let’s setup our study region, generate
environmental correlations, and define a harvest function prior to
initializing the template model with all the fixed parameters.</p>
<div class="section level5">
<h5 id="study-region">Study region<a class="anchor" aria-label="anchor" href="#study-region"></a>
</h5>
<p>First, we’ll define our study region (denoted U Island) with some
longitude-latitude coordinates.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Demonstration example region (U Island)</span></span>
<span><span class="va">coordinates</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span>
<span>  x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">177.01</span>, <span class="fl">177.05</span>, <span class="fl">0.01</span><span class="op">)</span>, <span class="fl">5</span><span class="op">)</span>,</span>
<span>  y <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="op">-</span><span class="fl">18.01</span>, <span class="op">-</span><span class="fl">18.05</span>, <span class="op">-</span><span class="fl">0.01</span><span class="op">)</span>, each <span class="op">=</span> <span class="fl">5</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="va">template_raster</span> <span class="op">&lt;-</span> <span class="va"><a href="../reference/Region.html">Region</a></span><span class="op">$</span><span class="fu">new</span><span class="op">(</span>coordinates <span class="op">=</span> <span class="va">coordinates</span><span class="op">)</span><span class="op">$</span><span class="va">region_raster</span> <span class="co"># full extent</span></span>
<span><span class="va">template_raster</span><span class="op">[</span><span class="op">]</span><span class="op">[</span><span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">7</span>, <span class="fl">9</span>, <span class="fl">12</span>, <span class="fl">14</span>, <span class="fl">17</span><span class="op">:</span><span class="fl">19</span><span class="op">)</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="cn">NA</span> <span class="co"># make U Island</span></span>
<span><span class="va">region</span> <span class="op">&lt;-</span> <span class="va"><a href="../reference/Region.html">Region</a></span><span class="op">$</span><span class="fu">new</span><span class="op">(</span>template_raster <span class="op">=</span> <span class="va">template_raster</span><span class="op">)</span></span>
<span><span class="fu">raster</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/base/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">region</span><span class="op">$</span><span class="va">region_raster</span>,</span>
<span>  main <span class="op">=</span> <span class="st">"Example region (cell indices)"</span>,</span>
<span>  xlab <span class="op">=</span> <span class="st">"Longitude (degrees)"</span>, ylab <span class="op">=</span> <span class="st">"Latitude (degrees)"</span>,</span>
<span>  colNA <span class="op">=</span> <span class="st">"blue"</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p><img src="simple_example_files/figure-html/unnamed-chunk-2-1.png" width="384" style="display: block; margin: auto;"></p>
</div>
<div class="section level5">
<h5 id="environmental-correlation">Environmental correlation<a class="anchor" aria-label="anchor" href="#environmental-correlation"></a>
</h5>
<p>Next, we’ll define a distance-based spatial correlation for applying
environmental stochasticity within our model. The generated correlation
data is compacted for computational efficiency (with large-scale
models).</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Distance-based environmental correlation (via a compacted Cholesky decomposition)</span></span>
<span><span class="va">env_corr</span> <span class="op">&lt;-</span> <span class="va"><a href="../reference/SpatialCorrelation.html">SpatialCorrelation</a></span><span class="op">$</span><span class="fu">new</span><span class="op">(</span>region <span class="op">=</span> <span class="va">region</span>, amplitude <span class="op">=</span> <span class="fl">0.4</span>, breadth <span class="op">=</span> <span class="fl">500</span><span class="op">)</span></span>
<span><span class="va">correlation</span> <span class="op">&lt;-</span> <span class="va">env_corr</span><span class="op">$</span><span class="fu">get_compact_decomposition</span><span class="op">(</span>decimals <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span>
<span><span class="va">correlation</span> <span class="co"># examine</span></span>
<span><span class="co">#&gt; $matrix</span></span>
<span><span class="co">#&gt;      [,1] [,2] [,3] [,4] [,5] [,6] [,7]</span></span>
<span><span class="co">#&gt; [1,]    1 0.01 0.04 0.04 0.04 0.02 0.04</span></span>
<span><span class="co">#&gt; [2,]    0 1.00 1.00 0.01 1.00 0.02 0.01</span></span>
<span><span class="co">#&gt; [3,]    0 0.00 0.00 1.00 0.00 0.05 0.05</span></span>
<span><span class="co">#&gt; [4,]    0 0.00 0.00 0.00 0.00 1.00 1.00</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $map</span></span>
<span><span class="co">#&gt;      [,1] [,2] [,3] [,4] [,5] [,6] [,7]</span></span>
<span><span class="co">#&gt; [1,]    1    1    1    2    3    3    4</span></span>
<span><span class="co">#&gt; [2,]   NA    2    3    3    5    4    5</span></span>
<span><span class="co">#&gt; [3,]   NA   NA   NA    4   NA    5    6</span></span>
<span><span class="co">#&gt; [4,]   NA   NA   NA   NA   NA    6    7</span></span></code></pre></div>
</div>
<div class="section level5">
<h5 id="harvest-function">Harvest function<a class="anchor" aria-label="anchor" href="#harvest-function"></a>
</h5>
<p>Let’s now define a simple harvest function, which is optionally
list-nested with a harvest rate parameter. We’ll also define an alias to
the harvest rate so we can sample this parameter later.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># User-defined harvest function (list-nested) and alias</span></span>
<span><span class="va">harvest</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>  rate <span class="op">=</span> <span class="cn">NA</span>, <span class="co"># sample later</span></span>
<span>  <span class="kw">function</span><span class="op">(</span><span class="va">params</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="va">params</span><span class="op">$</span><span class="va">stage_abundance</span> <span class="op">*</span> <span class="op">(</span><span class="fl">1</span> <span class="op">-</span> <span class="va">params</span><span class="op">$</span><span class="va">rate</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="va">harvest_rate_alias</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>harvest_rate <span class="op">=</span> <span class="st">"harvest$rate"</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level5">
<h5 id="template-model">Template model<a class="anchor" aria-label="anchor" href="#template-model"></a>
</h5>
<p>Finally, we can build our template model with these and other fixed
parameters.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Population (simulation) model template for fixed parameters</span></span>
<span><span class="va">stage_matrix</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span></span>
<span>    <span class="fl">0</span>, <span class="fl">2.5</span>, <span class="co"># Leslie/Lefkovitch matrix</span></span>
<span>    <span class="fl">0.8</span>, <span class="fl">0.5</span></span>
<span>  <span class="op">)</span>,</span>
<span>  nrow <span class="op">=</span> <span class="fl">2</span>, ncol <span class="op">=</span> <span class="fl">2</span>, byrow <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  dimnames <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"juv"</span>, <span class="st">"adult"</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"juv"</span>, <span class="st">"adult"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="va">stage_matrix</span> <span class="co"># examine</span></span>
<span><span class="co">#&gt;       juv adult</span></span>
<span><span class="co">#&gt; juv   0.0   2.5</span></span>
<span><span class="co">#&gt; adult 0.8   0.5</span></span>
<span><span class="va">model_template</span> <span class="op">&lt;-</span> <span class="va"><a href="../reference/PopulationModel.html">PopulationModel</a></span><span class="op">$</span><span class="fu">new</span><span class="op">(</span></span>
<span>  region <span class="op">=</span> <span class="va">region</span>,</span>
<span>  time_steps <span class="op">=</span> <span class="fl">10</span>, <span class="co"># years</span></span>
<span>  populations <span class="op">=</span> <span class="va">region</span><span class="op">$</span><span class="va">region_cells</span>, <span class="co"># 7</span></span>
<span>  stages <span class="op">=</span> <span class="fl">2</span>,</span>
<span>  stage_matrix <span class="op">=</span> <span class="va">stage_matrix</span>,</span>
<span>  demographic_stochasticity <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  standard_deviation <span class="op">=</span> <span class="fl">0.05</span>,</span>
<span>  correlation <span class="op">=</span> <span class="va">correlation</span>,</span>
<span>  density_dependence <span class="op">=</span> <span class="st">"logistic"</span>,</span>
<span>  harvest <span class="op">=</span> <span class="va">harvest</span>,</span>
<span>  results_selection <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"abundance"</span>, <span class="st">"harvested"</span><span class="op">)</span>,</span>
<span>  attribute_aliases <span class="op">=</span> <span class="va">harvest_rate_alias</span></span>
<span><span class="op">)</span></span></code></pre></div>
</div>
</div>
<div class="section level3">
<h3 id="step-2-build-generators-for-dynamically-generating-model-parameters">Step 2: Build generators for dynamically generating model
parameters<a class="anchor" aria-label="anchor" href="#step-2-build-generators-for-dynamically-generating-model-parameters"></a>
</h3>
<p>Some model parameters are single values, whilst others are
represented as arrays and other multi-value data structures. Usually, we
don’t wish to sample each individual value within these multi-value
parameters (in step 3), but to generate them dynamically via one or more
intermediate sampled parameters. Here we build generators for model
initial abundance, carrying capacity, and dispersal.</p>
<div class="section level5">
<h5 id="habitat-suitability">Habitat suitability<a class="anchor" aria-label="anchor" href="#habitat-suitability"></a>
</h5>
<p>Firstly, our initial abundance and carrying capacity generator
utilizes an example (mock) habitat suitability for our defined study
region.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Example habitat suitability</span></span>
<span><span class="va">example_hs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.8</span>, <span class="fl">1</span>, <span class="fl">0.7</span>, <span class="fl">0.9</span>, <span class="fl">0.6</span>, <span class="fl">0.7</span>, <span class="fl">0.8</span><span class="op">)</span></span>
<span><span class="va">example_hs_raster</span> <span class="op">&lt;-</span> <span class="va">region</span><span class="op">$</span><span class="va">region_raster</span></span>
<span><span class="va">example_hs_raster</span><span class="op">[</span><span class="va">region</span><span class="op">$</span><span class="va">region_indices</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">example_hs</span></span>
<span><span class="fu">raster</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/base/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">example_hs_raster</span>,</span>
<span>  main <span class="op">=</span> <span class="st">"Example habitat suitability"</span>,</span>
<span>  xlab <span class="op">=</span> <span class="st">"Longitude (degrees)"</span>, ylab <span class="op">=</span> <span class="st">"Latitude (degrees)"</span>,</span>
<span>  colNA <span class="op">=</span> <span class="st">"blue"</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p><img src="simple_example_files/figure-html/unnamed-chunk-6-1.png" width="384" style="display: block; margin: auto;"></p>
</div>
<div class="section level5">
<h5 id="initial-abundance-and-carrying-capacity-generator">Initial abundance and carrying capacity generator<a class="anchor" aria-label="anchor" href="#initial-abundance-and-carrying-capacity-generator"></a>
</h5>
<p>The generator utilizes generic template functionality for
user-defined custom functions. It uses sampled input parameters (initial
total abundance and maximum cell density), along with habitat
suitability, to generate the desired output model parameters (initial
abundance and carrying capacity) via these user-defined functions.
Generators can also be configured to read values from files or generate
values via probabilistic distributions.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Initial abundance and carrying capacity generated via example habitat suitability</span></span>
<span><span class="va">capacity_gen</span> <span class="op">&lt;-</span> <span class="va"><a href="../reference/Generator.html">Generator</a></span><span class="op">$</span><span class="fu">new</span><span class="op">(</span></span>
<span>  description <span class="op">=</span> <span class="st">"Capacity generator"</span>,</span>
<span>  example_hs <span class="op">=</span> <span class="va">example_hs</span>, <span class="co"># template attached</span></span>
<span>  inputs <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"initial_n"</span>, <span class="st">"density_max"</span><span class="op">)</span>,</span>
<span>  outputs <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"initial_abundance"</span>, <span class="st">"carrying_capacity"</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="va">capacity_gen</span><span class="op">$</span><span class="fu">add_generative_requirements</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>  initial_abundance <span class="op">=</span> <span class="st">"function"</span>,</span>
<span>  carrying_capacity <span class="op">=</span> <span class="st">"function"</span></span>
<span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">capacity_gen</span><span class="op">$</span><span class="fu">add_function_template</span><span class="op">(</span><span class="st">"initial_abundance"</span>,</span>
<span>  function_def <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">params</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="fu">stats</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/stats/Multinom.html" class="external-link">rmultinom</a></span><span class="op">(</span><span class="fl">1</span>,</span>
<span>      size <span class="op">=</span> <span class="va">params</span><span class="op">$</span><span class="va">initial_n</span>,</span>
<span>      prob <span class="op">=</span> <span class="va">params</span><span class="op">$</span><span class="va">example_hs</span></span>
<span>    <span class="op">)</span><span class="op">[</span>, <span class="fl">1</span><span class="op">]</span></span>
<span>  <span class="op">}</span>,</span>
<span>  call_params <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"initial_n"</span>, <span class="st">"example_hs"</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="va">capacity_gen</span><span class="op">$</span><span class="fu">add_function_template</span><span class="op">(</span><span class="st">"carrying_capacity"</span>,</span>
<span>  function_def <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">params</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="va">params</span><span class="op">$</span><span class="va">density_max</span> <span class="op">*</span> <span class="va">params</span><span class="op">$</span><span class="va">example_hs</span><span class="op">)</span></span>
<span>  <span class="op">}</span>,</span>
<span>  call_params <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"density_max"</span>, <span class="st">"example_hs"</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="va">capacity_gen</span><span class="op">$</span><span class="fu">generate</span><span class="op">(</span>input_values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>initial_n <span class="op">=</span> <span class="fl">500</span>, density_max <span class="op">=</span> <span class="fl">100</span><span class="op">)</span><span class="op">)</span> <span class="co"># test</span></span>
<span><span class="co">#&gt; $initial_abundance</span></span>
<span><span class="co">#&gt; [1] 70 90 73 72 56 68 71</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $carrying_capacity</span></span>
<span><span class="co">#&gt; [1]  80 100  70  90  60  70  80</span></span></code></pre></div>
</div>
<div class="section level5">
<h5 id="dispersal-generator">Dispersal generator<a class="anchor" aria-label="anchor" href="#dispersal-generator"></a>
</h5>
<p>Our dispersal generator uses default functionality for generating
dispersal rates between cells. Its sampled inputs parameterize the
distance-based dispersal function (proportion dispersing and breadth of
dispersal). The generator can be configured with a dispersal friction
helper class object, which calculates equivalent dispersal distances for
frictional landscapes and coastlines. Here it is used to ensure
dispersal is not performed directly across the “water” in our example
U-shaped island. The generated dispersal data is calculated via
pre-calculated distance data and compacted for computational efficiency
(with large-scale models).</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Distance-based dispersal generator</span></span>
<span><span class="va">dispersal_gen</span> <span class="op">&lt;-</span> <span class="va"><a href="../reference/DispersalGenerator.html">DispersalGenerator</a></span><span class="op">$</span><span class="fu">new</span><span class="op">(</span></span>
<span>  region <span class="op">=</span> <span class="va">region</span>,</span>
<span>  dispersal_max_distance <span class="op">=</span> <span class="fl">3000</span>, <span class="co"># in m</span></span>
<span>  dispersal_friction <span class="op">=</span> <span class="va"><a href="../reference/DispersalFriction.html">DispersalFriction</a></span><span class="op">$</span><span class="fu">new</span><span class="op">(</span><span class="op">)</span>,</span>
<span>  inputs <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"dispersal_p"</span>, <span class="st">"dispersal_b"</span><span class="op">)</span>,</span>
<span>  decimals <span class="op">=</span> <span class="fl">5</span></span>
<span><span class="op">)</span></span>
<span><span class="va">dispersal_gen</span><span class="op">$</span><span class="fu">calculate_distance_data</span><span class="op">(</span><span class="op">)</span> <span class="co"># pre-calculate</span></span>
<span><span class="va">test_dispersal</span> <span class="op">&lt;-</span> <span class="va">dispersal_gen</span><span class="op">$</span><span class="fu">generate</span><span class="op">(</span>input_values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>  dispersal_p <span class="op">=</span> <span class="fl">0.5</span>,</span>
<span>  dispersal_b <span class="op">=</span> <span class="fl">700</span></span>
<span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">test_dispersal</span><span class="op">$</span><span class="va">dispersal_data</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="co">#&gt;   target_pop source_pop emigrant_row immigrant_row dispersal_rate</span></span>
<span><span class="co">#&gt; 1          3          1            1             1        0.10284</span></span>
<span><span class="co">#&gt; 2          5          1            2             1        0.02115</span></span>
<span><span class="co">#&gt; 3          6          1            3             1        0.01501</span></span>
<span><span class="co">#&gt; 4          4          2            1             1        0.10284</span></span>
<span><span class="co">#&gt; 5          6          2            2             2        0.01501</span></span>
<span><span class="co">#&gt; 6          7          2            3             1        0.02115</span></span></code></pre></div>
<p>Note that there is no dispersal rate between cells 1 and 2 as there
is “water” between those cells, and consequently dispersal between those
cells must travel around the U-shaped island, which can’t be achieved in
one simulation time-step since the “round” distance between those cells
is greater than 3000 m.</p>
</div>
</div>
<div class="section level3">
<h3 id="step-3-sample-model-and-generator-parameters-for-each-simulation">Step 3: Sample model and generator parameters for each
simulation<a class="anchor" aria-label="anchor" href="#step-3-sample-model-and-generator-parameters-for-each-simulation"></a>
</h3>
<p>In order to explore the model parameter space to find the best
models, we generate Latin hypercube samples of model and generator
parameters to be simulated, using the <em>LatinHypercubeSampler</em>
class. This class has functionality for generating sample parameters via
Uniform, Normal, Lognormal, Beta, and Triangular distributions. For our
example we only generate 12 samples. We encourage the user to generate
hundreds, or thousands, of samples.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Generate sampled values for variable model parameters via LHS</span></span>
<span><span class="va">lhs_gen</span> <span class="op">&lt;-</span> <span class="va"><a href="../reference/LatinHypercubeSampler.html">LatinHypercubeSampler</a></span><span class="op">$</span><span class="fu">new</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">lhs_gen</span><span class="op">$</span><span class="fu">set_uniform_parameter</span><span class="op">(</span><span class="st">"growth_rate_max"</span>, lower <span class="op">=</span> <span class="fl">0.4</span>, upper <span class="op">=</span> <span class="fl">0.6</span>, decimals <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span>
<span><span class="va">lhs_gen</span><span class="op">$</span><span class="fu">set_uniform_parameter</span><span class="op">(</span><span class="st">"harvest_rate"</span>, lower <span class="op">=</span> <span class="fl">0.05</span>, upper <span class="op">=</span> <span class="fl">0.15</span>, decimals <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span>
<span><span class="va">lhs_gen</span><span class="op">$</span><span class="fu">set_uniform_parameter</span><span class="op">(</span><span class="st">"initial_n"</span>, lower <span class="op">=</span> <span class="fl">400</span>, upper <span class="op">=</span> <span class="fl">600</span>, decimals <span class="op">=</span> <span class="fl">0</span><span class="op">)</span></span>
<span><span class="va">lhs_gen</span><span class="op">$</span><span class="fu">set_uniform_parameter</span><span class="op">(</span><span class="st">"density_max"</span>, lower <span class="op">=</span> <span class="fl">80</span>, upper <span class="op">=</span> <span class="fl">120</span>, decimals <span class="op">=</span> <span class="fl">0</span><span class="op">)</span></span>
<span><span class="va">lhs_gen</span><span class="op">$</span><span class="fu">set_uniform_parameter</span><span class="op">(</span><span class="st">"dispersal_p"</span>, lower <span class="op">=</span> <span class="fl">0.2</span>, upper <span class="op">=</span> <span class="fl">0.5</span>, decimals <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span>
<span><span class="va">lhs_gen</span><span class="op">$</span><span class="fu">set_uniform_parameter</span><span class="op">(</span><span class="st">"dispersal_b"</span>, lower <span class="op">=</span> <span class="fl">400</span>, upper <span class="op">=</span> <span class="fl">1000</span>, decimals <span class="op">=</span> <span class="fl">0</span><span class="op">)</span></span>
<span><span class="va">sample_data</span> <span class="op">&lt;-</span> <span class="va">lhs_gen</span><span class="op">$</span><span class="fu">generate_samples</span><span class="op">(</span>number <span class="op">=</span> <span class="fl">12</span>, random_seed <span class="op">=</span> <span class="fl">123</span><span class="op">)</span></span>
<span><span class="va">sample_data</span> <span class="co"># examine</span></span>
<span><span class="co">#&gt;    growth_rate_max harvest_rate initial_n density_max dispersal_p dispersal_b</span></span>
<span><span class="co">#&gt; 1             0.50         0.09       575         111        0.26         481</span></span>
<span><span class="co">#&gt; 2             0.41         0.07       487          96        0.34         589</span></span>
<span><span class="co">#&gt; 3             0.44         0.09       483         110        0.42         509</span></span>
<span><span class="co">#&gt; 4             0.59         0.11       589          86        0.38         859</span></span>
<span><span class="co">#&gt; 5             0.56         0.06       441          92        0.21         667</span></span>
<span><span class="co">#&gt; 6             0.51         0.14       458         116        0.50         980</span></span>
<span><span class="co">#&gt; 7             0.54         0.05       416          88        0.28         447</span></span>
<span><span class="co">#&gt; 8             0.43         0.13       542         107        0.36         920</span></span>
<span><span class="co">#&gt; 9             0.46         0.12       422         101        0.43         849</span></span>
<span><span class="co">#&gt; 10            0.52         0.08       552          99        0.32         745</span></span>
<span><span class="co">#&gt; 11            0.48         0.11       525         119        0.25         789</span></span>
<span><span class="co">#&gt; 12            0.58         0.15       505          81        0.45         609</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="step-4-build-a-simulation-manager-to-run-each-simulation">Step 4: Build a simulation manager to run each simulation<a class="anchor" aria-label="anchor" href="#step-4-build-a-simulation-manager-to-run-each-simulation"></a>
</h3>
<p>We now wish to run a simulation for each set (or row) of sampled
parameters. The <em>SimulationManager</em> class manages the generation
of parameters (via the generators), the running the model simulations,
and writing simulation results to disk. It also maintains a log of each
simulation’s success and any errors or warnings encountered.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Create a simulation manager and run the sampled model simulations</span></span>
<span><span class="va">sim_manager</span> <span class="op">&lt;-</span> <span class="va"><a href="../reference/SimulationManager.html">SimulationManager</a></span><span class="op">$</span><span class="fu">new</span><span class="op">(</span></span>
<span>  sample_data <span class="op">=</span> <span class="va">sample_data</span>,</span>
<span>  model_template <span class="op">=</span> <span class="va">model_template</span>,</span>
<span>  generators <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">capacity_gen</span>, <span class="va">dispersal_gen</span><span class="op">)</span>,</span>
<span>  parallel_cores <span class="op">=</span> <span class="fl">2</span>,</span>
<span>  results_dir <span class="op">=</span> <span class="va">OUTPUT_DIR</span></span>
<span><span class="op">)</span></span>
<span><span class="va">run_output</span> <span class="op">&lt;-</span> <span class="va">sim_manager</span><span class="op">$</span><span class="fu">run</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">run_output</span><span class="op">$</span><span class="va">summary</span></span>
<span><span class="co">#&gt; [1] "12 of 12 sample models ran and saved results successfully"</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/list.files.html" class="external-link">dir</a></span><span class="op">(</span><span class="va">OUTPUT_DIR</span>, <span class="st">"*.RData"</span><span class="op">)</span> <span class="co"># includes 12 result files</span></span>
<span><span class="co">#&gt;  [1] "sample_1_results.RData"  "sample_10_results.RData"</span></span>
<span><span class="co">#&gt;  [3] "sample_11_results.RData" "sample_12_results.RData"</span></span>
<span><span class="co">#&gt;  [5] "sample_2_results.RData"  "sample_3_results.RData" </span></span>
<span><span class="co">#&gt;  [7] "sample_4_results.RData"  "sample_5_results.RData" </span></span>
<span><span class="co">#&gt;  [9] "sample_6_results.RData"  "sample_7_results.RData" </span></span>
<span><span class="co">#&gt; [11] "sample_8_results.RData"  "sample_9_results.RData"</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/list.files.html" class="external-link">dir</a></span><span class="op">(</span><span class="va">OUTPUT_DIR</span>, <span class="st">"*.txt"</span><span class="op">)</span> <span class="co"># plus simulation log</span></span>
<span><span class="co">#&gt; [1] "simulation_log.txt"</span></span></code></pre></div>
<p>Note that the output directory contains a R-data result files for
each sample simulation and a simulation log file.</p>
</div>
<div class="section level3">
<h3 id="step-5-build-a-results-manager-to-generate-summary-results-metrics">Step 5: Build a results manager to generate summary results
(metrics)<a class="anchor" aria-label="anchor" href="#step-5-build-a-results-manager-to-generate-summary-results-metrics"></a>
</h3>
<p>We now wish to collate summary results for each of our simulations
via the <em>ResultsManager</em> class. This manager loads the results
from each sample simulation into an intermediate
<em>PopulationResults</em> class object, which dynamically generates
further results. We need to define functions for calculating summary
metrics, as well as any matrices (one row of values per simulation) that
we may be interested in examining. Each metric (or matrix) is associated
with a user-defined function that utilizes results object attributes, or
alternatively direct access to an attribute may be defined via a string.
Once generated, the result metrics (a data frame) and/or matrices (a
list) can be accessed via the manager. We may utilize the collated
results in a variety of ways. However, with the objective of selecting
the best models, we wish to compare (or validate) these result metrics
to (with) known or desired target patterns (in step 6).</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">results_manager</span> <span class="op">&lt;-</span> <span class="va"><a href="../reference/ResultsManager.html">ResultsManager</a></span><span class="op">$</span><span class="fu">new</span><span class="op">(</span></span>
<span>  simulation_manager <span class="op">=</span> <span class="va">sim_manager</span>,</span>
<span>  simulation_results <span class="op">=</span> <span class="va"><a href="../reference/PopulationResults.html">PopulationResults</a></span><span class="op">$</span><span class="fu">new</span><span class="op">(</span><span class="op">)</span>,</span>
<span>  summary_metrics <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"trend_n"</span>, <span class="st">"total_h"</span><span class="op">)</span>,</span>
<span>  summary_matrices <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"n"</span>, <span class="st">"h"</span><span class="op">)</span>,</span>
<span>  summary_functions <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>    trend_n <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">results</span><span class="op">)</span> <span class="op">{</span></span>
<span>      <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="va">results</span><span class="op">$</span><span class="va">all</span><span class="op">$</span><span class="va">abundance_trend</span>, <span class="fl">2</span><span class="op">)</span></span>
<span>    <span class="op">}</span>,</span>
<span>    total_h <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">results</span><span class="op">)</span> <span class="op">{</span></span>
<span>      <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">results</span><span class="op">$</span><span class="va">harvested</span><span class="op">)</span></span>
<span>    <span class="op">}</span>,</span>
<span>    n <span class="op">=</span> <span class="st">"all$abundance"</span>, <span class="co"># string</span></span>
<span>    h <span class="op">=</span> <span class="st">"all$harvested"</span></span>
<span>  <span class="op">)</span>,</span>
<span>  parallel_cores <span class="op">=</span> <span class="fl">2</span></span>
<span><span class="op">)</span></span>
<span><span class="va">gen_output</span> <span class="op">&lt;-</span> <span class="va">results_manager</span><span class="op">$</span><span class="fu">generate</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">gen_output</span><span class="op">$</span><span class="va">summary</span></span>
<span><span class="co">#&gt; [1] "12 of 12 summary metrics/matrices generated from sample results successfully"</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/list.files.html" class="external-link">dir</a></span><span class="op">(</span><span class="va">OUTPUT_DIR</span>, <span class="st">"*.txt"</span><span class="op">)</span> <span class="co"># plus generation log</span></span>
<span><span class="co">#&gt; [1] "generation_log.txt" "simulation_log.txt"</span></span>
<span><span class="va">results_manager</span><span class="op">$</span><span class="va">summary_metric_data</span></span>
<span><span class="co">#&gt;    index trend_n total_h</span></span>
<span><span class="co">#&gt; 1      1   -7.00     492</span></span>
<span><span class="co">#&gt; 2      2    4.71     347</span></span>
<span><span class="co">#&gt; 3      3   -0.83     469</span></span>
<span><span class="co">#&gt; 4      4   -0.38     466</span></span>
<span><span class="co">#&gt; 5      5   -4.00     282</span></span>
<span><span class="co">#&gt; 6      6   -2.50     672</span></span>
<span><span class="co">#&gt; 7      7   -1.40     214</span></span>
<span><span class="co">#&gt; 8      8  -15.00     585</span></span>
<span><span class="co">#&gt; 9      9   -6.33     543</span></span>
<span><span class="co">#&gt; 10    10   -7.00     405</span></span>
<span><span class="co">#&gt; 11    11   -8.33     602</span></span>
<span><span class="co">#&gt; 12    12   -4.00     602</span></span>
<span><span class="va">results_manager</span><span class="op">$</span><span class="va">summary_matrix_list</span></span>
<span><span class="co">#&gt; $n</span></span>
<span><span class="co">#&gt;       [,1] [,2] [,3] [,4] [,5] [,6] [,7] [,8] [,9] [,10]</span></span>
<span><span class="co">#&gt;  [1,]  543  536  554  496  492  431  466  481  499   486</span></span>
<span><span class="co">#&gt;  [2,]  462  442  450  470  445  439  467  495  492   486</span></span>
<span><span class="co">#&gt;  [3,]  478  472  450  480  463  444  460  467  464   474</span></span>
<span><span class="co">#&gt;  [4,]  421  394  362  368  338  342  354  388  391   391</span></span>
<span><span class="co">#&gt;  [5,]  457  480  445  424  422  433  472  476  421   414</span></span>
<span><span class="co">#&gt;  [6,]  476  441  390  401  381  411  408  391  431   416</span></span>
<span><span class="co">#&gt;  [7,]  397  412  446  427  410  432  399  413  398   403</span></span>
<span><span class="co">#&gt;  [8,]  496  447  398  442  368  353  353  336  367   334</span></span>
<span><span class="co">#&gt;  [9,]  449  408  400  430  418  418  411  348  368   391</span></span>
<span><span class="co">#&gt; [10,]  541  520  470  453  456  412  438  455  468   477</span></span>
<span><span class="co">#&gt; [11,]  512  524  511  494  462  452  476  437  454   470</span></span>
<span><span class="co">#&gt; [12,]  389  385  346  319  312  293  310  341  361   341</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $h</span></span>
<span><span class="co">#&gt;       [,1] [,2] [,3] [,4] [,5] [,6] [,7] [,8] [,9] [,10]</span></span>
<span><span class="co">#&gt;  [1,]   53   55   55   48   50   42   44   48   49    48</span></span>
<span><span class="co">#&gt;  [2,]   35   33   34   36   33   34   34   37   35    36</span></span>
<span><span class="co">#&gt;  [3,]   48   47   46   47   46   46   47   49   47    46</span></span>
<span><span class="co">#&gt;  [4,]   52   48   45   47   42   43   45   48   48    48</span></span>
<span><span class="co">#&gt;  [5,]   29   33   30   26   26   27   29   30   27    25</span></span>
<span><span class="co">#&gt;  [6,]   79   71   61   66   63   65   66   62   71    68</span></span>
<span><span class="co">#&gt;  [7,]   20   22   23   22   20   22   20   25   19    21</span></span>
<span><span class="co">#&gt;  [8,]   75   67   60   65   55   54   53   51   55    50</span></span>
<span><span class="co">#&gt;  [9,]   60   55   54   58   56   55   53   47   50    55</span></span>
<span><span class="co">#&gt; [10,]   46   44   41   40   40   36   37   41   39    41</span></span>
<span><span class="co">#&gt; [11,]   63   64   63   62   57   57   60   56   59    61</span></span>
<span><span class="co">#&gt; [12,]   71   68   60   55   57   52   57   59   63    60</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="step-6-build-a-validator-to-select-a-model-ensemble">Step 6: Build a validator to select a model ensemble<a class="anchor" aria-label="anchor" href="#step-6-build-a-validator-to-select-a-model-ensemble"></a>
</h3>
<p>We now select and analyze our ‘best’ models via a <em>Validator</em>
class object, which by default utilizes an approximate Bayesian
computation (ABC) approach (Beaumont, Zhang, &amp; Balding, 2002)
provided by the <em>abc</em> library (Csillery et al., 2015). The
validator can be configured appropriately for a problem domain (see the
<em>abc</em> documentation). Here we use the default configuration to
select the best 3 models, along with a weight value, which is indicative
of the congruence between each model’s summary metrics and the
corresponding target patterns. Also provided (with the default settings)
is a diagnostic output (PDF) file, containing statistical information
for analyzing the contribution of model parameters in the
selection/validation process (see the <em>abc</em> documentation). For
our simple demonstration the metrics and corresponding targets are
relatively trivial, having the aim of producing stable population
abundances with high harvest. However, the package facilitates the use
more complex spatio-temporal metrics and targets (demonstrated in more
advanced vignettes).</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Create a validator for selecting the 'best' example models</span></span>
<span><span class="va">validator</span> <span class="op">&lt;-</span> <span class="va"><a href="../reference/Validator.html">Validator</a></span><span class="op">$</span><span class="fu">new</span><span class="op">(</span></span>
<span>  simulation_parameters <span class="op">=</span> <span class="va">sample_data</span>,</span>
<span>  simulation_summary_metrics <span class="op">=</span></span>
<span>    <span class="va">results_manager</span><span class="op">$</span><span class="va">summary_metric_data</span><span class="op">[</span><span class="op">-</span><span class="fl">1</span><span class="op">]</span>,</span>
<span>  observed_metric_targets <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>trend_n <span class="op">=</span> <span class="fl">0</span>, total_h <span class="op">=</span> <span class="fl">600</span><span class="op">)</span>,</span>
<span>  output_dir <span class="op">=</span> <span class="va">OUTPUT_DIR</span></span>
<span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/warning.html" class="external-link">suppressWarnings</a></span><span class="op">(</span><span class="va">validator</span><span class="op">$</span><span class="fu">run</span><span class="op">(</span>tolerance <span class="op">=</span> <span class="fl">0.25</span>, output_diagnostics <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; 12345678910</span></span>
<span><span class="co">#&gt; 12345678910</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/list.files.html" class="external-link">dir</a></span><span class="op">(</span><span class="va">OUTPUT_DIR</span>, <span class="st">"*.pdf"</span><span class="op">)</span> <span class="co"># plus validation diagnostics (see abc library documentation)</span></span>
<span><span class="co">#&gt; [1] "validation_diagnostics.pdf"</span></span>
<span><span class="va">validator</span><span class="op">$</span><span class="va">selected_simulations</span> <span class="co"># top 3 models (stable abundance and high harvest)</span></span>
<span><span class="co">#&gt;   index      weight</span></span>
<span><span class="co">#&gt; 1     3 0.001237578</span></span>
<span><span class="co">#&gt; 2     4 0.000000000</span></span>
<span><span class="co">#&gt; 3     6 0.226283766</span></span></code></pre></div>
<p>We encourage the user to examine the generated diagnostics (PDF)
output file, and to become acquainted with the analysis that this
information facilitates (see the <em>abc</em> documentation). As our
simple example only uses two metrics/targets, we can visualize the
congruence of the selected models with the targets via a simple
plot.</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Plot the simulation, targets, and selected metrics</span></span>
<span><span class="fu">graphics</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span></span>
<span>  x <span class="op">=</span> <span class="va">results_manager</span><span class="op">$</span><span class="va">summary_metric_data</span><span class="op">$</span><span class="va">total_h</span>,</span>
<span>  y <span class="op">=</span> <span class="va">results_manager</span><span class="op">$</span><span class="va">summary_metric_data</span><span class="op">$</span><span class="va">trend_n</span>,</span>
<span>  main <span class="op">=</span> <span class="st">"Example model validation"</span>,</span>
<span>  xlab <span class="op">=</span> <span class="st">"Total harvested"</span>, ylab <span class="op">=</span> <span class="st">"Abundance trend"</span></span>
<span><span class="op">)</span></span>
<span><span class="fu">graphics</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/graphics/points.html" class="external-link">points</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fl">600</span>, y <span class="op">=</span> <span class="fl">0</span>, col <span class="op">=</span> <span class="st">"red"</span>, pch <span class="op">=</span> <span class="fl">4</span><span class="op">)</span></span>
<span><span class="va">selected_indices</span> <span class="op">&lt;-</span> <span class="va">validator</span><span class="op">$</span><span class="va">selected_simulations</span><span class="op">$</span><span class="va">index</span></span>
<span><span class="fu">graphics</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/graphics/points.html" class="external-link">points</a></span><span class="op">(</span></span>
<span>  x <span class="op">=</span> <span class="va">results_manager</span><span class="op">$</span><span class="va">summary_metric_data</span><span class="op">$</span><span class="va">total_h</span><span class="op">[</span><span class="va">selected_indices</span><span class="op">]</span>,</span>
<span>  y <span class="op">=</span> <span class="va">results_manager</span><span class="op">$</span><span class="va">summary_metric_data</span><span class="op">$</span><span class="va">trend_n</span><span class="op">[</span><span class="va">selected_indices</span><span class="op">]</span>,</span>
<span>  col <span class="op">=</span> <span class="st">"blue"</span>, pch <span class="op">=</span> <span class="fl">3</span></span>
<span><span class="op">)</span></span>
<span><span class="fu">graphics</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/graphics/legend.html" class="external-link">legend</a></span><span class="op">(</span><span class="st">"bottomleft"</span>,</span>
<span>  legend <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Summary metrics"</span>, <span class="st">"Targets"</span>, <span class="st">"Selected"</span><span class="op">)</span>,</span>
<span>  col <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="st">"red"</span>, <span class="st">"blue"</span><span class="op">)</span>, pch <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">4</span>, <span class="fl">3</span><span class="op">)</span>, cex <span class="op">=</span> <span class="fl">0.8</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p><img src="simple_example_files/figure-html/unnamed-chunk-13-1.png" width="576" style="display: block; margin: auto;"></p>
</div>
</div>
<div class="section level2">
<h2 id="summary">Summary<a class="anchor" aria-label="anchor" href="#summary"></a>
</h2>
<p>This demonstration has provided an overview of the <em>poems</em>
workflow and modules via a simple population model example. We hope it
has given you the foundation to progress to our more advanced Tasmanian
<em>Thylacine</em> vignette, and towards utilizing the package for your
own modeling projects.</p>
<p>Thank you :-)</p>
</div>
<div class="section level2">
<h2 id="references">References<a class="anchor" aria-label="anchor" href="#references"></a>
</h2>
<p>Beaumont, M. A., Zhang, W., &amp; Balding, D. J. (2002). ‘Approximate
Bayesian computation in population genetics’. <em>Genetics</em>,
vol. 162, no. 4, pp, 2025–2035.</p>
<p>Csillery, K., Lemaire L., Francois O., &amp; Blum M. (2015). ‘abc:
Tools for Approximate Bayesian Computation (ABC)’. <em>R package version
2.1</em>. Retrieved from <a href="https://CRAN.R-project.org/package=abc" class="external-link uri">https://CRAN.R-project.org/package=abc</a></p>
<p>Grimm, V., Revilla, E., Berger, U., Jeltsch, F., Mooij, W. M.,
Railsback, S. F., Thulke, H. H., Weiner, J., Wiegand, T., DeAngelis, D.
L., (2005). ‘Pattern-Oriented Modeling of Agent-Based Complex Systems:
Lessons from Ecology’. <em>Science</em> vol. 310, no. 5750,
pp. 987–991.</p>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by Sean Haythorne, Damien Fordham, Stuart Brown, Jessie Buettel, Barry Brook, <a href="https://pilowsky.me" class="external-link">July Pilowsky</a>.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
